"use strict";var cov_1a2srhzug7=function(){var path="C:\\Users\\PRAKASHSELVARAJ\\Blockchain\\Home Depot\\Development\\chaincode_0901\\src\\contracts\\ifc-staged.contract.ts";var hash="992b506b483607d5077b3930c1c048417b430e3a";var global=new Function("return this")();var gcv="__coverage__";var coverageData={path:"C:\\Users\\PRAKASHSELVARAJ\\Blockchain\\Home Depot\\Development\\chaincode_0901\\src\\contracts\\ifc-staged.contract.ts",statementMap:{"0":{start:{line:2,column:17},end:{line:7,column:1}},"1":{start:{line:3,column:12},end:{line:3,column:28}},"2":{start:{line:3,column:34},end:{line:3,column:125}},"3":{start:{line:4,column:4},end:{line:5,column:150}},"4":{start:{line:4,column:79},end:{line:4,column:131}},"5":{start:{line:5,column:9},end:{line:5,column:150}},"6":{start:{line:5,column:22},end:{line:5,column:43}},"7":{start:{line:5,column:58},end:{line:5,column:150}},"8":{start:{line:5,column:81},end:{line:5,column:150}},"9":{start:{line:6,column:4},end:{line:6,column:66}},"10":{start:{line:8,column:17},end:{line:10,column:1}},"11":{start:{line:9,column:4},end:{line:9,column:109}},"12":{start:{line:9,column:79},end:{line:9,column:109}},"13":{start:{line:11,column:0},end:{line:11,column:62}},"14":{start:{line:12,column:30},end:{line:12,column:60}},"15":{start:{line:13,column:17},end:{line:13,column:37}},"16":{start:{line:14,column:23},end:{line:14,column:49}},"17":{start:{line:15,column:28},end:{line:15,column:59}},"18":{start:{line:16,column:15},end:{line:16,column:35}},"19":{start:{line:17,column:15},end:{line:17,column:69}},"20":{start:{line:18,column:24},end:{line:134,column:1}},"21":{start:{line:19,column:20},end:{line:19,column:73}},"22":{start:{line:22,column:8},end:{line:39,column:9}},"23":{start:{line:24,column:12},end:{line:26,column:13}},"24":{start:{line:25,column:16},end:{line:25,column:82}},"25":{start:{line:28,column:22},end:{line:28,column:24}},"26":{start:{line:29,column:12},end:{line:32,column:13}},"27":{start:{line:30,column:37},end:{line:30,column:117}},"28":{start:{line:31,column:16},end:{line:31,column:41}},"29":{start:{line:33,column:12},end:{line:33,column:23}},"30":{start:{line:36,column:12},end:{line:36,column:53}},"31":{start:{line:37,column:12},end:{line:37,column:28}},"32":{start:{line:38,column:12},end:{line:38,column:19}},"33":{start:{line:43,column:8},end:{line:132,column:9}},"34":{start:{line:45,column:12},end:{line:45,column:39}},"35":{start:{line:46,column:12},end:{line:48,column:13}},"36":{start:{line:47,column:16},end:{line:47,column:111}},"37":{start:{line:49,column:12},end:{line:51,column:13}},"38":{start:{line:49,column:53},end:{line:49,column:85}},"39":{start:{line:50,column:16},end:{line:50,column:125}},"40":{start:{line:52,column:25},end:{line:52,column:75}},"41":{start:{line:54,column:21},end:{line:54,column:74}},"42":{start:{line:55,column:26},end:{line:55,column:30}},"43":{start:{line:56,column:12},end:{line:61,column:13}},"44":{start:{line:57,column:16},end:{line:57,column:60}},"45":{start:{line:58,column:16},end:{line:58,column:48}},"46":{start:{line:59,column:16},end:{line:59,column:32}},"47":{start:{line:60,column:16},end:{line:60,column:58}},"48":{start:{line:63,column:12},end:{line:63,column:61}},"49":{start:{line:64,column:26},end:{line:64,column:91}},"50":{start:{line:65,column:12},end:{line:67,column:13}},"51":{start:{line:66,column:16},end:{line:66,column:72}},"52":{start:{line:68,column:12},end:{line:68,column:47}},"53":{start:{line:70,column:12},end:{line:70,column:62}},"54":{start:{line:71,column:30},end:{line:71,column:89}},"55":{start:{line:72,column:12},end:{line:74,column:13}},"56":{start:{line:73,column:16},end:{line:73,column:70}},"57":{start:{line:75,column:12},end:{line:75,column:51}},"58":{start:{line:77,column:12},end:{line:77,column:144}},"59":{start:{line:78,column:12},end:{line:111,column:13}},"60":{start:{line:80,column:16},end:{line:80,column:88}},"61":{start:{line:81,column:16},end:{line:89,column:19}},"62":{start:{line:82,column:46},end:{line:84,column:22}},"63":{start:{line:83,column:24},end:{line:83,column:144}},"64":{start:{line:85,column:20},end:{line:88,column:21}},"65":{start:{line:86,column:24},end:{line:86,column:85}},"66":{start:{line:87,column:24},end:{line:87,column:64}},"67":{start:{line:91,column:33},end:{line:100,column:22}},"68":{start:{line:92,column:46},end:{line:94,column:22}},"69":{start:{line:93,column:24},end:{line:93,column:144}},"70":{start:{line:95,column:20},end:{line:98,column:21}},"71":{start:{line:96,column:24},end:{line:96,column:94}},"72":{start:{line:97,column:24},end:{line:97,column:37}},"73":{start:{line:99,column:20},end:{line:99,column:31}},"74":{start:{line:101,column:16},end:{line:101,column:90}},"75":{start:{line:103,column:16},end:{line:106,column:17}},"76":{start:{line:104,column:20},end:{line:104,column:102}},"77":{start:{line:105,column:20},end:{line:105,column:54}},"78":{start:{line:109,column:16},end:{line:109,column:86}},"79":{start:{line:110,column:16},end:{line:110,column:83}},"80":{start:{line:113,column:12},end:{line:113,column:59}},"81":{start:{line:114,column:28},end:{line:114,column:110}},"82":{start:{line:115,column:12},end:{line:115,column:59}},"83":{start:{line:117,column:12},end:{line:124,column:13}},"84":{start:{line:118,column:16},end:{line:118,column:62}},"85":{start:{line:119,column:16},end:{line:119,column:47}},"86":{start:{line:122,column:16},end:{line:122,column:68}},"87":{start:{line:123,column:16},end:{line:123,column:47}},"88":{start:{line:125,column:12},end:{line:125,column:118}},"89":{start:{line:126,column:12},end:{line:126,column:29}},"90":{start:{line:129,column:12},end:{line:129,column:75}},"91":{start:{line:130,column:12},end:{line:130,column:28}},"92":{start:{line:131,column:12},end:{line:131,column:19}},"93":{start:{line:135,column:0},end:{line:142,column:59}},"94":{start:{line:143,column:0},end:{line:151,column:55}},"95":{start:{line:152,column:0},end:{line:155,column:22}},"96":{start:{line:156,column:0},end:{line:156,column:46}}},fnMap:{"0":{name:"(anonymous_0)",decl:{start:{line:2,column:46},end:{line:2,column:47}},loc:{start:{line:2,column:87},end:{line:7,column:1}},line:2},"1":{name:"(anonymous_1)",decl:{start:{line:8,column:46},end:{line:8,column:47}},loc:{start:{line:8,column:62},end:{line:10,column:1}},line:8},"2":{name:"(anonymous_2)",decl:{start:{line:19,column:4},end:{line:19,column:5}},loc:{start:{line:19,column:18},end:{line:19,column:75}},line:19},"3":{name:"(anonymous_3)",decl:{start:{line:21,column:4},end:{line:21,column:5}},loc:{start:{line:21,column:58},end:{line:40,column:5}},line:21},"4":{name:"(anonymous_4)",decl:{start:{line:42,column:4},end:{line:42,column:5}},loc:{start:{line:42,column:57},end:{line:133,column:5}},line:42},"5":{name:"(anonymous_5)",decl:{start:{line:49,column:38},end:{line:49,column:39}},loc:{start:{line:49,column:51},end:{line:49,column:87}},line:49},"6":{name:"(anonymous_6)",decl:{start:{line:81,column:41},end:{line:81,column:42}},loc:{start:{line:81,column:57},end:{line:89,column:17}},line:81},"7":{name:"(anonymous_7)",decl:{start:{line:82,column:70},end:{line:82,column:71}},loc:{start:{line:82,column:101},end:{line:84,column:21}},line:82},"8":{name:"(anonymous_8)",decl:{start:{line:91,column:57},end:{line:91,column:58}},loc:{start:{line:91,column:78},end:{line:100,column:17}},line:91},"9":{name:"(anonymous_9)",decl:{start:{line:92,column:70},end:{line:92,column:71}},loc:{start:{line:92,column:101},end:{line:94,column:21}},line:92}},branchMap:{"0":{loc:{start:{line:2,column:17},end:{line:7,column:1}},type:"binary-expr",locations:[{start:{line:2,column:18},end:{line:2,column:22}},{start:{line:2,column:26},end:{line:2,column:41}},{start:{line:2,column:46},end:{line:7,column:1}}],line:2},"1":{loc:{start:{line:3,column:34},end:{line:3,column:125}},type:"cond-expr",locations:[{start:{line:3,column:42},end:{line:3,column:48}},{start:{line:3,column:51},end:{line:3,column:125}}],line:3},"2":{loc:{start:{line:3,column:51},end:{line:3,column:125}},type:"cond-expr",locations:[{start:{line:3,column:67},end:{line:3,column:118}},{start:{line:3,column:121},end:{line:3,column:125}}],line:3},"3":{loc:{start:{line:4,column:4},end:{line:5,column:150}},type:"if",locations:[{start:{line:4,column:4},end:{line:5,column:150}},{start:{line:4,column:4},end:{line:5,column:150}}],line:4},"4":{loc:{start:{line:4,column:8},end:{line:4,column:77}},type:"binary-expr",locations:[{start:{line:4,column:8},end:{line:4,column:35}},{start:{line:4,column:39},end:{line:4,column:77}}],line:4},"5":{loc:{start:{line:5,column:58},end:{line:5,column:150}},type:"if",locations:[{start:{line:5,column:58},end:{line:5,column:150}},{start:{line:5,column:58},end:{line:5,column:150}}],line:5},"6":{loc:{start:{line:5,column:85},end:{line:5,column:149}},type:"binary-expr",locations:[{start:{line:5,column:86},end:{line:5,column:143}},{start:{line:5,column:148},end:{line:5,column:149}}],line:5},"7":{loc:{start:{line:5,column:86},end:{line:5,column:143}},type:"cond-expr",locations:[{start:{line:5,column:94},end:{line:5,column:98}},{start:{line:5,column:101},end:{line:5,column:143}}],line:5},"8":{loc:{start:{line:5,column:101},end:{line:5,column:143}},type:"cond-expr",locations:[{start:{line:5,column:109},end:{line:5,column:126}},{start:{line:5,column:129},end:{line:5,column:143}}],line:5},"9":{loc:{start:{line:6,column:11},end:{line:6,column:62}},type:"binary-expr",locations:[{start:{line:6,column:11},end:{line:6,column:16}},{start:{line:6,column:20},end:{line:6,column:21}},{start:{line:6,column:25},end:{line:6,column:62}}],line:6},"10":{loc:{start:{line:8,column:17},end:{line:10,column:1}},type:"binary-expr",locations:[{start:{line:8,column:18},end:{line:8,column:22}},{start:{line:8,column:26},end:{line:8,column:41}},{start:{line:8,column:46},end:{line:10,column:1}}],line:8},"11":{loc:{start:{line:9,column:4},end:{line:9,column:109}},type:"if",locations:[{start:{line:9,column:4},end:{line:9,column:109}},{start:{line:9,column:4},end:{line:9,column:109}}],line:9},"12":{loc:{start:{line:9,column:8},end:{line:9,column:77}},type:"binary-expr",locations:[{start:{line:9,column:8},end:{line:9,column:35}},{start:{line:9,column:39},end:{line:9,column:77}}],line:9},"13":{loc:{start:{line:24,column:12},end:{line:26,column:13}},type:"if",locations:[{start:{line:24,column:12},end:{line:26,column:13}},{start:{line:24,column:12},end:{line:26,column:13}}],line:24},"14":{loc:{start:{line:46,column:12},end:{line:48,column:13}},type:"if",locations:[{start:{line:46,column:12},end:{line:48,column:13}},{start:{line:46,column:12},end:{line:48,column:13}}],line:46},"15":{loc:{start:{line:49,column:12},end:{line:51,column:13}},type:"if",locations:[{start:{line:49,column:12},end:{line:51,column:13}},{start:{line:49,column:12},end:{line:51,column:13}}],line:49},"16":{loc:{start:{line:56,column:12},end:{line:61,column:13}},type:"if",locations:[{start:{line:56,column:12},end:{line:61,column:13}},{start:{line:56,column:12},end:{line:61,column:13}}],line:56},"17":{loc:{start:{line:65,column:12},end:{line:67,column:13}},type:"if",locations:[{start:{line:65,column:12},end:{line:67,column:13}},{start:{line:65,column:12},end:{line:67,column:13}}],line:65},"18":{loc:{start:{line:72,column:12},end:{line:74,column:13}},type:"if",locations:[{start:{line:72,column:12},end:{line:74,column:13}},{start:{line:72,column:12},end:{line:74,column:13}}],line:72},"19":{loc:{start:{line:77,column:34},end:{line:77,column:116}},type:"cond-expr",locations:[{start:{line:77,column:94},end:{line:77,column:100}},{start:{line:77,column:103},end:{line:77,column:116}}],line:77},"20":{loc:{start:{line:77,column:35},end:{line:77,column:90}},type:"binary-expr",locations:[{start:{line:77,column:35},end:{line:77,column:62}},{start:{line:77,column:66},end:{line:77,column:90}}],line:77},"21":{loc:{start:{line:78,column:12},end:{line:111,column:13}},type:"if",locations:[{start:{line:78,column:12},end:{line:111,column:13}},{start:{line:78,column:12},end:{line:111,column:13}}],line:78},"22":{loc:{start:{line:78,column:16},end:{line:78,column:71}},type:"binary-expr",locations:[{start:{line:78,column:16},end:{line:78,column:43}},{start:{line:78,column:47},end:{line:78,column:71}}],line:78},"23":{loc:{start:{line:83,column:31},end:{line:83,column:143}},type:"binary-expr",locations:[{start:{line:83,column:31},end:{line:83,column:52}},{start:{line:83,column:56},end:{line:83,column:77}},{start:{line:83,column:81},end:{line:83,column:108}},{start:{line:83,column:112},end:{line:83,column:143}}],line:83},"24":{loc:{start:{line:85,column:20},end:{line:88,column:21}},type:"if",locations:[{start:{line:85,column:20},end:{line:88,column:21}},{start:{line:85,column:20},end:{line:88,column:21}}],line:85},"25":{loc:{start:{line:93,column:31},end:{line:93,column:143}},type:"binary-expr",locations:[{start:{line:93,column:31},end:{line:93,column:52}},{start:{line:93,column:56},end:{line:93,column:77}},{start:{line:93,column:81},end:{line:93,column:108}},{start:{line:93,column:112},end:{line:93,column:143}}],line:93},"26":{loc:{start:{line:95,column:20},end:{line:98,column:21}},type:"if",locations:[{start:{line:95,column:20},end:{line:98,column:21}},{start:{line:95,column:20},end:{line:98,column:21}}],line:95},"27":{loc:{start:{line:103,column:16},end:{line:106,column:17}},type:"if",locations:[{start:{line:103,column:16},end:{line:106,column:17}},{start:{line:103,column:16},end:{line:106,column:17}}],line:103},"28":{loc:{start:{line:117,column:12},end:{line:124,column:13}},type:"if",locations:[{start:{line:117,column:12},end:{line:124,column:13}},{start:{line:117,column:12},end:{line:124,column:13}}],line:117}},s:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0,"29":0,"30":0,"31":0,"32":0,"33":0,"34":0,"35":0,"36":0,"37":0,"38":0,"39":0,"40":0,"41":0,"42":0,"43":0,"44":0,"45":0,"46":0,"47":0,"48":0,"49":0,"50":0,"51":0,"52":0,"53":0,"54":0,"55":0,"56":0,"57":0,"58":0,"59":0,"60":0,"61":0,"62":0,"63":0,"64":0,"65":0,"66":0,"67":0,"68":0,"69":0,"70":0,"71":0,"72":0,"73":0,"74":0,"75":0,"76":0,"77":0,"78":0,"79":0,"80":0,"81":0,"82":0,"83":0,"84":0,"85":0,"86":0,"87":0,"88":0,"89":0,"90":0,"91":0,"92":0,"93":0,"94":0,"95":0,"96":0},f:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0},b:{"0":[0,0,0],"1":[0,0],"2":[0,0],"3":[0,0],"4":[0,0],"5":[0,0],"6":[0,0],"7":[0,0],"8":[0,0],"9":[0,0,0],"10":[0,0,0],"11":[0,0],"12":[0,0],"13":[0,0],"14":[0,0],"15":[0,0],"16":[0,0],"17":[0,0],"18":[0,0],"19":[0,0],"20":[0,0],"21":[0,0],"22":[0,0],"23":[0,0,0,0],"24":[0,0],"25":[0,0,0,0],"26":[0,0],"27":[0,0],"28":[0,0]},_coverageSchema:"43e27e138ebf9cfc5966b082cf9a028302ed4184",hash:"992b506b483607d5077b3930c1c048417b430e3a"};var coverage=global[gcv]||(global[gcv]={});if(coverage[path]&&coverage[path].hash===hash){return coverage[path];}return coverage[path]=coverageData;}();var __decorate=(cov_1a2srhzug7.s[0]++,(cov_1a2srhzug7.b[0][0]++,this)&&(cov_1a2srhzug7.b[0][1]++,this.__decorate)||(cov_1a2srhzug7.b[0][2]++,function(decorators,target,key,desc){cov_1a2srhzug7.f[0]++;var c=(cov_1a2srhzug7.s[1]++,arguments.length),r=(cov_1a2srhzug7.s[2]++,c<3?(cov_1a2srhzug7.b[1][0]++,target):(cov_1a2srhzug7.b[1][1]++,desc===null?(cov_1a2srhzug7.b[2][0]++,desc=Object.getOwnPropertyDescriptor(target,key)):(cov_1a2srhzug7.b[2][1]++,desc))),d;cov_1a2srhzug7.s[3]++;if((cov_1a2srhzug7.b[4][0]++,typeof Reflect==="object")&&(cov_1a2srhzug7.b[4][1]++,typeof Reflect.decorate==="function")){cov_1a2srhzug7.b[3][0]++;cov_1a2srhzug7.s[4]++;r=Reflect.decorate(decorators,target,key,desc);}else{cov_1a2srhzug7.b[3][1]++;cov_1a2srhzug7.s[5]++;for(var i=(cov_1a2srhzug7.s[6]++,decorators.length-1);i>=0;i--){cov_1a2srhzug7.s[7]++;if(d=decorators[i]){cov_1a2srhzug7.b[5][0]++;cov_1a2srhzug7.s[8]++;r=(cov_1a2srhzug7.b[6][0]++,c<3?(cov_1a2srhzug7.b[7][0]++,d(r)):(cov_1a2srhzug7.b[7][1]++,c>3?(cov_1a2srhzug7.b[8][0]++,d(target,key,r)):(cov_1a2srhzug7.b[8][1]++,d(target,key))))||(cov_1a2srhzug7.b[6][1]++,r);}else{cov_1a2srhzug7.b[5][1]++;}}}cov_1a2srhzug7.s[9]++;return(cov_1a2srhzug7.b[9][0]++,c>3)&&(cov_1a2srhzug7.b[9][1]++,r)&&(cov_1a2srhzug7.b[9][2]++,Object.defineProperty(target,key,r)),r;}));var __metadata=(cov_1a2srhzug7.s[10]++,(cov_1a2srhzug7.b[10][0]++,this)&&(cov_1a2srhzug7.b[10][1]++,this.__metadata)||(cov_1a2srhzug7.b[10][2]++,function(k,v){cov_1a2srhzug7.f[1]++;cov_1a2srhzug7.s[11]++;if((cov_1a2srhzug7.b[12][0]++,typeof Reflect==="object")&&(cov_1a2srhzug7.b[12][1]++,typeof Reflect.metadata==="function")){cov_1a2srhzug7.b[11][0]++;cov_1a2srhzug7.s[12]++;return Reflect.metadata(k,v);}else{cov_1a2srhzug7.b[11][1]++;}}));cov_1a2srhzug7.s[13]++;Object.defineProperty(exports,"__esModule",{value:true});const fabric_contract_api_1=(cov_1a2srhzug7.s[14]++,require("fabric-contract-api"));const models_1=(cov_1a2srhzug7.s[15]++,require("../models"));const repositories_1=(cov_1a2srhzug7.s[16]++,require("../repositories"));const processing_engine_1=(cov_1a2srhzug7.s[17]++,require("../processing-engine"));const Logger=(cov_1a2srhzug7.s[18]++,require('../logger'));const logger=(cov_1a2srhzug7.s[19]++,Logger.getLogger('./contracts/ifc-staged.contract.ts'));cov_1a2srhzug7.s[20]++;let IFCStagedContract=class IFCStagedContract extends fabric_contract_api_1.Contract{constructor(){cov_1a2srhzug7.f[2]++;cov_1a2srhzug7.s[21]++;super("com.homedepot.procurement.IFCStagedContract");}// Used to bulk merge several records of new IFCStaged data with existing IFCStaged data
async bulkSaveIFCStaged(ctx,newListOfIFCStagedLists){cov_1a2srhzug7.f[3]++;cov_1a2srhzug7.s[22]++;try{cov_1a2srhzug7.s[23]++;// Sanity-checks: list.length > 0
if(newListOfIFCStagedLists.length===0){cov_1a2srhzug7.b[13][0]++;cov_1a2srhzug7.s[24]++;throw new Error(`bulkSaveIFCStaged was called with 0 IFCStageds`);}else{cov_1a2srhzug7.b[13][1]++;}// Add each set of PO items to the blockchain, one PONumber at a time
let aps=(cov_1a2srhzug7.s[25]++,[]);cov_1a2srhzug7.s[26]++;for(let currentItemsList of newListOfIFCStagedLists){let currentSavedAP=(cov_1a2srhzug7.s[27]++,await this.saveIFCStaged(ctx,currentItemsList.PONumber,currentItemsList.Items));cov_1a2srhzug7.s[28]++;aps.push(currentSavedAP);}cov_1a2srhzug7.s[29]++;return aps;}catch(e){cov_1a2srhzug7.s[30]++;logger.error(`bulkSaveIFCStaged failed`);cov_1a2srhzug7.s[31]++;logger.error(e);cov_1a2srhzug7.s[32]++;return;}}// Used to merge new IFCStaged data with existing IFCStaged data
async saveIFCStaged(ctx,poNumber,newIFCStagedList){cov_1a2srhzug7.f[4]++;cov_1a2srhzug7.s[33]++;try{cov_1a2srhzug7.s[34]++;// Sanity-checks: istlist.length > 0, all items in vslist have PONumber=poNumber
poNumber=poNumber.trim();cov_1a2srhzug7.s[35]++;if(newIFCStagedList.length===0){cov_1a2srhzug7.b[14][0]++;cov_1a2srhzug7.s[36]++;throw new Error(`saveIFCStaged was called with 0 IFCStaged items, for PONumber '${poNumber}'`);}else{cov_1a2srhzug7.b[14][1]++;}cov_1a2srhzug7.s[37]++;if(newIFCStagedList.some((v,i,l)=>{cov_1a2srhzug7.f[5]++;cov_1a2srhzug7.s[38]++;return v.PONumber!=poNumber;})){cov_1a2srhzug7.b[15][0]++;cov_1a2srhzug7.s[39]++;throw new Error(`saveIFCStaged was called with some IFCStaged items that do not have PONUmber '${poNumber}`);}else{cov_1a2srhzug7.b[15][1]++;}let apRepo=(cov_1a2srhzug7.s[40]++,new repositories_1.AssetProcurementRepository(ctx));// Retrieve or create the AssetProcurement record
let ap=(cov_1a2srhzug7.s[41]++,new models_1.AssetProcurement({PONumber:poNumber}));let apIsNew=(cov_1a2srhzug7.s[42]++,true);cov_1a2srhzug7.s[43]++;if((await apRepo.exists(poNumber))==true){cov_1a2srhzug7.b[16][0]++;cov_1a2srhzug7.s[44]++;logger.debug(`PONumber ${poNumber} exists`);cov_1a2srhzug7.s[45]++;ap=await apRepo.get(poNumber);cov_1a2srhzug7.s[46]++;apIsNew=false;cov_1a2srhzug7.s[47]++;logger.debug('Retreived AP from storage');}else{cov_1a2srhzug7.b[16][1]++;}// Get the list of UnitOfMeasure data
cov_1a2srhzug7.s[48]++;logger.debug('Retrieving UOM data from storage');let uomList=(cov_1a2srhzug7.s[49]++,await new repositories_1.UnitOfMeasureListRepository(ctx).get());cov_1a2srhzug7.s[50]++;if(uomList===undefined){cov_1a2srhzug7.b[17][0]++;cov_1a2srhzug7.s[51]++;uomList=new models_1.UnitOfMeasureList({Items:[]});}else{cov_1a2srhzug7.b[17][1]++;}cov_1a2srhzug7.s[52]++;logger.debug(uomList.Items.length);// Retrieve the current ADR Rule data
cov_1a2srhzug7.s[53]++;logger.debug('Retrieving ADR Rules from storage');let adrRuleList=(cov_1a2srhzug7.s[54]++,await new repositories_1.ADRRuleListRepository(ctx).get());cov_1a2srhzug7.s[55]++;if(adrRuleList===undefined){cov_1a2srhzug7.b[18][0]++;cov_1a2srhzug7.s[56]++;adrRuleList=new models_1.ADRRuleList({Items:[]});}else{cov_1a2srhzug7.b[18][1]++;}cov_1a2srhzug7.s[57]++;logger.debug(adrRuleList.Items.length);// Merge the existing IFCStaged data with the new data
cov_1a2srhzug7.s[58]++;logger.debug('We '+((cov_1a2srhzug7.b[20][0]++,ap.IFCStageds!==undefined)&&(cov_1a2srhzug7.b[20][1]++,ap.IFCStageds.length>0)?(cov_1a2srhzug7.b[19][0]++,'have'):(cov_1a2srhzug7.b[19][1]++,'do not have'))+' IST data for the AP');cov_1a2srhzug7.s[59]++;if((cov_1a2srhzug7.b[22][0]++,ap.IFCStageds!==undefined)&&(cov_1a2srhzug7.b[22][1]++,ap.IFCStageds.length>0)){cov_1a2srhzug7.b[21][0]++;cov_1a2srhzug7.s[60]++;// Merge any records that match on key identifier fields
logger.debug(`Starting with ${newIFCStagedList.length} new IFCStageds`);cov_1a2srhzug7.s[61]++;newIFCStagedList.forEach((vc,ic,lc)=>{cov_1a2srhzug7.f[6]++;let existingRecordIndex=(cov_1a2srhzug7.s[62]++,ap.IFCStageds.findIndex((innerVC,innerIC,innerLC)=>{cov_1a2srhzug7.f[7]++;cov_1a2srhzug7.s[63]++;return(cov_1a2srhzug7.b[23][0]++,vc.RDC==innerVC.RDC)&&(cov_1a2srhzug7.b[23][1]++,vc.SKU==innerVC.SKU)&&(cov_1a2srhzug7.b[23][2]++,vc.UCC128==innerVC.UCC128)&&(cov_1a2srhzug7.b[23][3]++,vc.PONumber==innerVC.PONumber);}));cov_1a2srhzug7.s[64]++;if(existingRecordIndex>-1){cov_1a2srhzug7.b[24][0]++;cov_1a2srhzug7.s[65]++;logger.debug('Found a new IST that matched an existing one');cov_1a2srhzug7.s[66]++;ap.IFCStageds[existingRecordIndex]=vc;}else{cov_1a2srhzug7.b[24][1]++;}});// Deterimine all records that are new and do not match any existing records
let uniqueISTs=(cov_1a2srhzug7.s[67]++,newIFCStagedList.reduce((pac,vc,ic,lc)=>{cov_1a2srhzug7.f[8]++;let existingRecordIndex=(cov_1a2srhzug7.s[68]++,ap.IFCStageds.findIndex((innerVC,innerIC,innerLC)=>{cov_1a2srhzug7.f[9]++;cov_1a2srhzug7.s[69]++;return(cov_1a2srhzug7.b[25][0]++,vc.RDC==innerVC.RDC)&&(cov_1a2srhzug7.b[25][1]++,vc.SKU==innerVC.SKU)&&(cov_1a2srhzug7.b[25][2]++,vc.UCC128==innerVC.UCC128)&&(cov_1a2srhzug7.b[25][3]++,vc.PONumber==innerVC.PONumber);}));cov_1a2srhzug7.s[70]++;if(existingRecordIndex==-1){cov_1a2srhzug7.b[26][0]++;cov_1a2srhzug7.s[71]++;logger.debug('Found a new IST that does not match the existing ones');cov_1a2srhzug7.s[72]++;pac.push(vc);}else{cov_1a2srhzug7.b[26][1]++;}cov_1a2srhzug7.s[73]++;return pac;},[]));cov_1a2srhzug7.s[74]++;logger.debug(`Ended up with ${uniqueISTs.length} totally new IFCStageds`);// If we found some new records to add, Append new records to the existing ones
cov_1a2srhzug7.s[75]++;if(uniqueISTs.length>0){cov_1a2srhzug7.b[27][0]++;cov_1a2srhzug7.s[76]++;logger.debug('Adding the final list of unique ISTs to the existing list of ISTs');cov_1a2srhzug7.s[77]++;ap.IFCStageds.push(...uniqueISTs);}else{cov_1a2srhzug7.b[27][1]++;}}else{cov_1a2srhzug7.b[21][1]++;cov_1a2srhzug7.s[78]++;logger.debug('Adding all new ISTs since there are no existing ISTs.');cov_1a2srhzug7.s[79]++;ap.setStageDetails(models_1.StageType.IFCStaged,newIFCStagedList);}// Run this through the processing engine (FSM)
cov_1a2srhzug7.s[80]++;logger.debug('Starting the processing engine');let updatedAP=(cov_1a2srhzug7.s[81]++,processing_engine_1.ProcessingEngine.startProcessing(ap,{uomList,adrRuleList}));cov_1a2srhzug7.s[82]++;logger.debug('Finished the processing engine');// Save the AssetProcurement record
cov_1a2srhzug7.s[83]++;if(apIsNew){cov_1a2srhzug7.b[28][0]++;cov_1a2srhzug7.s[84]++;logger.debug('Attempting to create a new AP');cov_1a2srhzug7.s[85]++;await apRepo.create(updatedAP);}else{cov_1a2srhzug7.b[28][1]++;cov_1a2srhzug7.s[86]++;logger.debug('Attempting to update an existing AP');cov_1a2srhzug7.s[87]++;await apRepo.update(updatedAP);}cov_1a2srhzug7.s[88]++;logger.debug(`saveIFCShipped saved ${newIFCStagedList.length} IFCShipped items for PONumber ${poNumber}`);cov_1a2srhzug7.s[89]++;return updatedAP;}catch(e){cov_1a2srhzug7.s[90]++;logger.error(`saveIFCShipped failed for PONumber ${poNumber}`);cov_1a2srhzug7.s[91]++;logger.error(e);cov_1a2srhzug7.s[92]++;return;}}};cov_1a2srhzug7.s[93]++;__decorate([fabric_contract_api_1.Transaction(),fabric_contract_api_1.Param("newListOfIFCStagedLists","IFCStagedList[]"),fabric_contract_api_1.Returns('AssetProcurement[]'),__metadata("design:type",Function),__metadata("design:paramtypes",[fabric_contract_api_1.Context,Array]),__metadata("design:returntype",Promise)],IFCStagedContract.prototype,"bulkSaveIFCStaged",null);cov_1a2srhzug7.s[94]++;__decorate([fabric_contract_api_1.Transaction(),fabric_contract_api_1.Param("poNumber","string"),fabric_contract_api_1.Param("newIFCStagedList","IFCStaged[]"),fabric_contract_api_1.Returns('AssetProcurement'),__metadata("design:type",Function),__metadata("design:paramtypes",[fabric_contract_api_1.Context,String,Array]),__metadata("design:returntype",Promise)],IFCStagedContract.prototype,"saveIFCStaged",null);cov_1a2srhzug7.s[95]++;IFCStagedContract=__decorate([fabric_contract_api_1.Info({title:'IFCStagedContract',description:'Contract for managing the list of IFCStageds, and their related discrepancies'}),__metadata("design:paramtypes",[])],IFCStagedContract);cov_1a2srhzug7.s[96]++;exports.IFCStagedContract=IFCStagedContract;//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiQzpcXFVzZXJzXFxQUkFLQVNIU0VMVkFSQUpcXEJsb2NrY2hhaW5cXEhvbWUgRGVwb3RcXERldmVsb3BtZW50XFxjaGFpbmNvZGVfMDkwMVxcc3JjXFxjb250cmFjdHNcXGlmYy1zdGFnZWQuY29udHJhY3QudHMiLCJzb3VyY2VzIjpbIkM6XFxVc2Vyc1xcUFJBS0FTSFNFTFZBUkFKXFxCbG9ja2NoYWluXFxIb21lIERlcG90XFxEZXZlbG9wbWVudFxcY2hhaW5jb2RlXzA5MDFcXHNyY1xcY29udHJhY3RzXFxpZmMtc3RhZ2VkLmNvbnRyYWN0LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7O0FBQUEsNkRBQTJGO0FBQzNGLHNDQUEwSTtBQUMxSSxrREFBaUg7QUFDakgsNERBQXdEO0FBRXhELE1BQU0sTUFBTSxHQUFHLE9BQU8sQ0FBQyxXQUFXLENBQUMsQ0FBQztBQUNwQyxNQUFNLE1BQU0sR0FBRyxNQUFNLENBQUMsU0FBUyxDQUFDLG9DQUFvQyxDQUFDLENBQUM7QUFJdEUsSUFBYSxpQkFBaUIsR0FBOUIsTUFBYSxpQkFBa0IsU0FBUSw4QkFBUTtJQUczQyxnQkFBZ0IsS0FBSyxDQUFDLDZDQUE2QyxDQUFDLENBQUMsQ0FBQyxDQUFDO0lBR3ZFLHdGQUF3RjtJQUlqRixLQUFLLENBQUMsaUJBQWlCLENBQUMsR0FBWSxFQUFFLHVCQUF3QztRQUNqRixJQUFJO1lBQ0EsaUNBQWlDO1lBQ2pDLElBQUksdUJBQXVCLENBQUMsTUFBTSxLQUFLLENBQUMsRUFBQztnQkFDckMsTUFBTSxJQUFJLEtBQUssQ0FBQyxnREFBZ0QsQ0FBQyxDQUFDO2FBQ3JFO1lBRUQscUVBQXFFO1lBQ3JFLElBQUksR0FBRyxHQUF3QixFQUFFLENBQUM7WUFDbEMsS0FBSyxJQUFJLGdCQUFnQixJQUFJLHVCQUF1QixFQUFFO2dCQUNsRCxJQUFJLGNBQWMsR0FBc0IsTUFBTSxJQUFJLENBQUMsYUFBYSxDQUFDLEdBQUcsRUFBRSxnQkFBZ0IsQ0FBQyxRQUFRLEVBQUUs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LCtFQUErRSxFQUFFLENBQUM7O0dBQ3RILGlCQUFpQixDQXNJN0I7QUF0SVksOENBQWlCIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQ29udGV4dCwgQ29udHJhY3QsIEluZm8sIFJldHVybnMsIFRyYW5zYWN0aW9uLCBQYXJhbSB9IGZyb20gJ2ZhYnJpYy1jb250cmFjdC1hcGknO1xyXG5pbXBvcnQgeyBJRkNTdGFnZWQsIEFzc2V0UHJvY3VyZW1lbnQsIFN0YWdlVHlwZSwgVW5pdE9mTWVhc3VyZSwgVW5pdE9mTWVhc3VyZUxpc3QsIEFEUlJ1bGUsIEFEUlJ1bGVMaXN0LCBJRkNTdGFnZWRMaXN0IH0gZnJvbSBcIi4uL21vZGVsc1wiO1xyXG5pbXBvcnQgeyBBc3NldFByb2N1cmVtZW50UmVwb3NpdG9yeSwgVW5pdE9mTWVhc3VyZUxpc3RSZXBvc2l0b3J5LCBBRFJSdWxlTGlzdFJlcG9zaXRvcnkgfSBmcm9tICcuLi9yZXBvc2l0b3JpZXMnO1xyXG5pbXBvcnQgeyBQcm9jZXNzaW5nRW5naW5lIH0gZnJvbSAnLi4vcHJvY2Vzc2luZy1lbmdpbmUnO1xyXG5cclxuY29uc3QgTG9nZ2VyID0gcmVxdWlyZSgnLi4vbG9nZ2VyJyk7XHJcbmNvbnN0IGxvZ2dlciA9IExvZ2dlci5nZXRMb2dnZXIoJy4vY29udHJhY3RzL2lmYy1zdGFnZWQuY29udHJhY3QudHMnKTtcclxuXHJcblxyXG5ASW5mbyh7IHRpdGxlOiAnSUZDU3RhZ2VkQ29udHJhY3QnLCBkZXNjcmlwdGlvbjogJ0NvbnRyYWN0IGZvciBtYW5hZ2luZyB0aGUgbGlzdCBvZiBJRkNTdGFnZWRzLCBhbmQgdGhlaXIgcmVsYXRlZCBkaXNjcmVwYW5jaWVzJyB9KVxyXG5leHBvcnQgY2xhc3MgSUZDU3RhZ2VkQ29udHJhY3QgZXh0ZW5kcyBDb250cmFjdCB7XHJcblxyXG5cclxuICAgIGNvbnN0cnVjdG9yKCkgeyBzdXBlcihcImNvbS5ob21lZGVwb3QucHJvY3VyZW1lbnQuSUZDU3RhZ2VkQ29udHJhY3RcIik7IH1cclxuXHJcblxyXG4gICAgLy8gVXNlZCB0byBidWxrIG1lcmdlIHNldmVyYWwgcmVjb3JkcyBvZiBuZXcgSUZDU3RhZ2VkIGRhdGEgd2l0aCBleGlzdGluZyBJRkNTdGFnZWQgZGF0YVxyXG4gICAgQFRyYW5zYWN0aW9uKClcclxuICAgIEBQYXJhbShcIm5ld0xpc3RPZklGQ1N0YWdlZExpc3RzXCIsIFwiSUZDU3RhZ2VkTGlzdFtdXCIpXHJcbiAgICBAUmV0dXJucygnQXNzZXRQcm9jdXJlbWVudFtdJykgICAgXHJcbiAgICBwdWJsaWMgYXN5bmMgYnVsa1NhdmVJRkNTdGFnZWQoY3R4OiBDb250ZXh0LCBuZXdMaXN0T2ZJRkNTdGFnZWRMaXN0czogSUZDU3RhZ2VkTGlzdFtdKTogUHJvbWlzZTxBc3NldFByb2N1cmVtZW50W10+IHsgIFxyXG4gICAgICAgIHRyeSB7XHJcbiAgICAgICAgICAgIC8vIFNhbml0eS1jaGVja3M6IGxpc3QubGVuZ3RoID4gMFxyXG4gICAgICAgICAgICBpZiAobmV3TGlzdE9mSUZDU3RhZ2VkTGlzdHMubGVuZ3RoID09PSAwKXsgXHJcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYGJ1bGtTYXZlSUZDU3RhZ2VkIHdhcyBjYWxsZWQgd2l0aCAwIElGQ1N0YWdlZHNgKTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgLy8gQWRkIGVhY2ggc2V0IG9mIFBPIGl0ZW1zIHRvIHRoZSBibG9ja2NoYWluLCBvbmUgUE9OdW1iZXIgYXQgYSB0aW1lXHJcbiAgICAgICAgICAgIGxldCBhcHMgOiBBc3NldFByb2N1cmVtZW50W10gPSBbXTtcclxuICAgICAgICAgICAgZm9yIChsZXQgY3VycmVudEl0ZW1zTGlzdCBvZiBuZXdMaXN0T2ZJRkNTdGFnZWRMaXN0cykge1xyXG4gICAgICAgICAgICAgICAgbGV0IGN1cnJlbnRTYXZlZEFQIDogQXNzZXRQcm9jdXJlbWVudCA9IGF3YWl0IHRoaXMuc2F2ZUlGQ1N0YWdlZChjdHgsIGN1cnJlbnRJdGVtc0xpc3QuUE9OdW1iZXIsIGN1cnJlbnRJdGVtc0xpc3QuSXRlbXMpO1xyXG4gICAgICAgICAgICAgICAgYXBzLnB1c2goY3VycmVudFNhdmVkQVApO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICByZXR1cm4gYXBzO1xyXG4gICAgICAgIH0gY2F0Y2ggKGUpIHtcclxuICAgICAgICAgICAgbG9nZ2VyLmVycm9yKGBidWxrU2F2ZUlGQ1N0YWdlZCBmYWlsZWRgKTtcclxuICAgICAgICAgICAgbG9nZ2VyLmVycm9yKGUpO1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuXHJcbiAgICAvLyBVc2VkIHRvIG1lcmdlIG5ldyBJRkNTdGFnZWQgZGF0YSB3aXRoIGV4aXN0aW5nIElGQ1N0YWdlZCBkYXRhXHJcbiAgICBAVHJhbnNhY3Rpb24oKVxyXG4gICAgQFBhcmFtKFwicG9OdW1iZXJcIiwgXCJzdHJpbmdcIilcclxuICAgIEBQYXJhbShcIm5ld0lGQ1N0YWdlZExpc3RcIiwgXCJJRkNTdGFnZWRbXVwiKVxyXG4gICAgQFJldHVybnMoJ0Fzc2V0UHJvY3VyZW1lbnQnKSAgICBcclxuICAgIHB1YmxpYyBhc3luYyBzYXZlSUZDU3RhZ2VkKGN0eDogQ29udGV4dCwgcG9OdW1iZXI6IHN0cmluZywgbmV3SUZDU3RhZ2VkTGlzdDogSUZDU3RhZ2VkW10pOiBQcm9taXNlPEFzc2V0UHJvY3VyZW1lbnQ+IHsgIFxyXG4gICAgICAgIHRyeSB7XHJcbiAgICAgICAgICAgIC8vIFNhbml0eS1jaGVja3M6IGlzdGxpc3QubGVuZ3RoID4gMCwgYWxsIGl0ZW1zIGluIHZzbGlzdCBoYXZlIFBPTnVtYmVyPXBvTnVtYmVyXHJcbiAgICAgICAgICAgIHBvTnVtYmVyID0gcG9OdW1iZXIudHJpbSgpO1xyXG4gICAgICAgICAgICBpZiAobmV3SUZDU3RhZ2VkTGlzdC5sZW5ndGggPT09IDApeyBcclxuICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihgc2F2ZUlGQ1N0YWdlZCB3YXMgY2FsbGVkIHdpdGggMCBJRkNTdGFnZWQgaXRlbXMsIGZvciBQT051bWJlciAnJHtwb051bWJlcn0nYCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKG5ld0lGQ1N0YWdlZExpc3Quc29tZSgodixpLGwpPT57IHJldHVybiAodi5QT051bWJlciAhPSBwb051bWJlcik7IH0pKSB7XHJcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYHNhdmVJRkNTdGFnZWQgd2FzIGNhbGxlZCB3aXRoIHNvbWUgSUZDU3RhZ2VkIGl0ZW1zIHRoYXQgZG8gbm90IGhhdmUgUE9OVW1iZXIgJyR7cG9OdW1iZXJ9YCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIGxldCBhcFJlcG8gOiBBc3NldFByb2N1cmVtZW50UmVwb3NpdG9yeSA9IG5ldyBBc3NldFByb2N1cmVtZW50UmVwb3NpdG9yeShjdHgpO1xyXG5cclxuICAgICAgICAgICAgLy8gUmV0cmlldmUgb3IgY3JlYXRlIHRoZSBBc3NldFByb2N1cmVtZW50IHJlY29yZFxyXG4gICAgICAgICAgICBsZXQgYXAgOiBBc3NldFByb2N1cmVtZW50ID0gbmV3IEFzc2V0UHJvY3VyZW1lbnQoeyBQT051bWJlcjogcG9OdW1iZXIgfSk7XHJcbiAgICAgICAgICAgIGxldCBhcElzTmV3IDogYm9vbGVhbiA9IHRydWU7XHJcbiAgICAgICAgICAgIGlmIChhd2FpdCBhcFJlcG8uZXhpc3RzKHBvTnVtYmVyKSA9PSB0cnVlKSB7XHJcbiAgICAgICAgICAgICAgICBsb2dnZXIuZGVidWcoYFBPTnVtYmVyICR7cG9OdW1iZXJ9IGV4aXN0c2ApO1xyXG4gICAgICAgICAgICAgICAgYXAgPSBhd2FpdCBhcFJlcG8uZ2V0KHBvTnVtYmVyKTtcclxuICAgICAgICAgICAgICAgIGFwSXNOZXcgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgIGxvZ2dlci5kZWJ1ZygnUmV0cmVpdmVkIEFQIGZyb20gc3RvcmFnZScpO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAvLyBHZXQgdGhlIGxpc3Qgb2YgVW5pdE9mTWVhc3VyZSBkYXRhXHJcbiAgICAgICAgICAgIGxvZ2dlci5kZWJ1ZygnUmV0cmlldmluZyBVT00gZGF0YSBmcm9tIHN0b3JhZ2UnKTtcclxuICAgICAgICAgICAgbGV0IHVvbUxpc3QgOiBVbml0T2ZNZWFzdXJlTGlzdCB8IHVuZGVmaW5lZCA9IGF3YWl0IChuZXcgVW5pdE9mTWVhc3VyZUxpc3RSZXBvc2l0b3J5KGN0eCkpLmdldCgpO1xyXG4gICAgICAgICAgICBpZiAodW9tTGlzdCA9PT0gdW5kZWZpbmVkKXsgdW9tTGlzdCA9IG5ldyBVbml0T2ZNZWFzdXJlTGlzdCh7IEl0ZW1zOiBbXSB9KTsgfVxyXG4gICAgICAgICAgICBsb2dnZXIuZGVidWcodW9tTGlzdC5JdGVtcy5sZW5ndGgpO1xyXG4gICAgICAgIFxyXG4gICAgICAgICAgICAvLyBSZXRyaWV2ZSB0aGUgY3VycmVudCBBRFIgUnVsZSBkYXRhXHJcbiAgICAgICAgICAgIGxvZ2dlci5kZWJ1ZygnUmV0cmlldmluZyBBRFIgUnVsZXMgZnJvbSBzdG9yYWdlJyk7XHJcbiAgICAgICAgICAgIGxldCBhZHJSdWxlTGlzdCA6IEFEUlJ1bGVMaXN0IHwgdW5kZWZpbmVkID0gYXdhaXQgKG5ldyBBRFJSdWxlTGlzdFJlcG9zaXRvcnkoY3R4KSkuZ2V0KCk7XHJcbiAgICAgICAgICAgIGlmIChhZHJSdWxlTGlzdCA9PT0gdW5kZWZpbmVkKXsgYWRyUnVsZUxpc3QgPSBuZXcgQURSUnVsZUxpc3QoeyBJdGVtczogW10gfSk7IH1cclxuICAgICAgICAgICAgbG9nZ2VyLmRlYnVnKGFkclJ1bGVMaXN0Lkl0ZW1zLmxlbmd0aCk7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAvLyBNZXJnZSB0aGUgZXhpc3RpbmcgSUZDU3RhZ2VkIGRhdGEgd2l0aCB0aGUgbmV3IGRhdGFcclxuICAgICAgICAgICAgbG9nZ2VyLmRlYnVnKCdXZSAnICsgKChhcC5JRkNTdGFnZWRzICE9PSB1bmRlZmluZWQgJiYgYXAuSUZDU3RhZ2Vkcy5sZW5ndGggPiAwKSA/ICdoYXZlJyA6ICdkbyBub3QgaGF2ZScpICsgJyBJU1QgZGF0YSBmb3IgdGhlIEFQJyk7XHJcbiAgICAgICAgICAgIGlmIChhcC5JRkNTdGFnZWRzICE9PSB1bmRlZmluZWQgJiYgYXAuSUZDU3RhZ2Vkcy5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAgICAgICAgICAvLyBNZXJnZSBhbnkgcmVjb3JkcyB0aGF0IG1hdGNoIG9uIGtleSBpZGVudGlmaWVyIGZpZWxkc1xyXG4gICAgICAgICAgICAgICAgbG9nZ2VyLmRlYnVnKGBTdGFydGluZyB3aXRoICR7bmV3SUZDU3RhZ2VkTGlzdC5sZW5ndGh9IG5ldyBJRkNTdGFnZWRzYCk7XHJcbiAgICAgICAgICAgICAgICBuZXdJRkNTdGFnZWRMaXN0LmZvckVhY2goKHZjLGljLGxjKT0+e1xyXG4gICAgICAgICAgICAgICAgICAgIGxldCBleGlzdGluZ1JlY29yZEluZGV4ID0gYXAuSUZDU3RhZ2VkcyEuZmluZEluZGV4KChpbm5lclZDLGlubmVySUMsaW5uZXJMQyk9PntcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHZjLlJEQz09aW5uZXJWQy5SREMgJiYgdmMuU0tVID09IGlubmVyVkMuU0tVICYmIHZjLlVDQzEyOCA9PSBpbm5lclZDLlVDQzEyOCAmJiB2Yy5QT051bWJlcj09aW5uZXJWQy5QT051bWJlcjtcclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoZXhpc3RpbmdSZWNvcmRJbmRleCA+IC0xKSB7IFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBsb2dnZXIuZGVidWcoJ0ZvdW5kIGEgbmV3IElTVCB0aGF0IG1hdGNoZWQgYW4gZXhpc3Rpbmcgb25lJyk7IFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBhcC5JRkNTdGFnZWRzIVtleGlzdGluZ1JlY29yZEluZGV4XSA9IHZjO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgICAgIC8vIERldGVyaW1pbmUgYWxsIHJlY29yZHMgdGhhdCBhcmUgbmV3IGFuZCBkbyBub3QgbWF0Y2ggYW55IGV4aXN0aW5nIHJlY29yZHNcclxuICAgICAgICAgICAgICAgIGxldCB1bmlxdWVJU1RzIDogSUZDU3RhZ2VkW10gPSBuZXdJRkNTdGFnZWRMaXN0LnJlZHVjZSgocGFjOklGQ1N0YWdlZFtdLHZjLGljLGxjKT0+e1xyXG4gICAgICAgICAgICAgICAgICAgIGxldCBleGlzdGluZ1JlY29yZEluZGV4ID0gYXAuSUZDU3RhZ2VkcyEuZmluZEluZGV4KChpbm5lclZDLGlubmVySUMsaW5uZXJMQyk9PntcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHZjLlJEQz09aW5uZXJWQy5SREMgJiYgdmMuU0tVID09IGlubmVyVkMuU0tVICYmIHZjLlVDQzEyOCA9PSBpbm5lclZDLlVDQzEyOCAmJiB2Yy5QT051bWJlcj09aW5uZXJWQy5QT051bWJlcjtcclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoZXhpc3RpbmdSZWNvcmRJbmRleCA9PSAtMSkgeyBcclxuICAgICAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLmRlYnVnKCdGb3VuZCBhIG5ldyBJU1QgdGhhdCBkb2VzIG5vdCBtYXRjaCB0aGUgZXhpc3Rpbmcgb25lcycpOyBcclxuICAgICAgICAgICAgICAgICAgICAgICAgcGFjLnB1c2godmMpOyBcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHBhYztcclxuICAgICAgICAgICAgICAgIH0sIFtdKTtcclxuICAgICAgICAgICAgICAgIGxvZ2dlci5kZWJ1ZyhgRW5kZWQgdXAgd2l0aCAke3VuaXF1ZUlTVHMubGVuZ3RofSB0b3RhbGx5IG5ldyBJRkNTdGFnZWRzYCk7XHJcbiAgXHJcbiAgICAgICAgICAgICAgICAvLyBJZiB3ZSBmb3VuZCBzb21lIG5ldyByZWNvcmRzIHRvIGFkZCwgQXBwZW5kIG5ldyByZWNvcmRzIHRvIHRoZSBleGlzdGluZyBvbmVzXHJcbiAgICAgICAgICAgICAgICBpZiAodW5pcXVlSVNUcy5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLmRlYnVnKCdBZGRpbmcgdGhlIGZpbmFsIGxpc3Qgb2YgdW5pcXVlIElTVHMgdG8gdGhlIGV4aXN0aW5nIGxpc3Qgb2YgSVNUcycpO1xyXG4gICAgICAgICAgICAgICAgICAgIGFwLklGQ1N0YWdlZHMucHVzaCguLi51bmlxdWVJU1RzKTtcclxuICAgICAgICAgICAgICAgIH0gICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgbG9nZ2VyLmRlYnVnKCdBZGRpbmcgYWxsIG5ldyBJU1RzIHNpbmNlIHRoZXJlIGFyZSBubyBleGlzdGluZyBJU1RzLicpO1xyXG4gICAgICAgICAgICAgICAgYXAuc2V0U3RhZ2VEZXRhaWxzKFN0YWdlVHlwZS5JRkNTdGFnZWQsIG5ld0lGQ1N0YWdlZExpc3QpO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAvLyBSdW4gdGhpcyB0aHJvdWdoIHRoZSBwcm9jZXNzaW5nIGVuZ2luZSAoRlNNKVxyXG4gICAgICAgICAgICBsb2dnZXIuZGVidWcoJ1N0YXJ0aW5nIHRoZSBwcm9jZXNzaW5nIGVuZ2luZScpO1xyXG4gICAgICAgICAgICBsZXQgdXBkYXRlZEFQIDogQXNzZXRQcm9jdXJlbWVudCA9IFByb2Nlc3NpbmdFbmdpbmUuc3RhcnRQcm9jZXNzaW5nKGFwLCB7IHVvbUxpc3QsIGFkclJ1bGVMaXN0IH0pO1xyXG4gICAgICAgICAgICBsb2dnZXIuZGVidWcoJ0ZpbmlzaGVkIHRoZSBwcm9jZXNzaW5nIGVuZ2luZScpO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgLy8gU2F2ZSB0aGUgQXNzZXRQcm9jdXJlbWVudCByZWNvcmRcclxuICAgICAgICAgICAgaWYgKGFwSXNOZXcpIHtcclxuICAgICAgICAgICAgICAgIGxvZ2dlci5kZWJ1ZygnQXR0ZW1wdGluZyB0byBjcmVhdGUgYSBuZXcgQVAnKTtcclxuICAgICAgICAgICAgICAgIGF3YWl0IGFwUmVwby5jcmVhdGUodXBkYXRlZEFQKTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIGxvZ2dlci5kZWJ1ZygnQXR0ZW1wdGluZyB0byB1cGRhdGUgYW4gZXhpc3RpbmcgQVAnKTtcclxuICAgICAgICAgICAgICAgIGF3YWl0IGFwUmVwby51cGRhdGUodXBkYXRlZEFQKTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgbG9nZ2VyLmRlYnVnKGBzYXZlSUZDU2hpcHBlZCBzYXZlZCAke25ld0lGQ1N0YWdlZExpc3QubGVuZ3RofSBJRkNTaGlwcGVkIGl0ZW1zIGZvciBQT051bWJlciAke3BvTnVtYmVyfWApO1xyXG4gICAgICAgICAgICByZXR1cm4gdXBkYXRlZEFQO1xyXG4gICAgICAgIH0gY2F0Y2ggKGUpIHtcclxuICAgICAgICAgICAgbG9nZ2VyLmVycm9yKGBzYXZlSUZDU2hpcHBlZCBmYWlsZWQgZm9yIFBPTnVtYmVyICR7cG9OdW1iZXJ9YCk7XHJcbiAgICAgICAgICAgIGxvZ2dlci5lcnJvcihlKTtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbn0iXX0=