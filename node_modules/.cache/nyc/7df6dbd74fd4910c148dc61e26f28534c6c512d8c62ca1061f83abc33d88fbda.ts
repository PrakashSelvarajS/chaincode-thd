"use strict";var cov_202xh21jbv=function(){var path="C:\\Users\\PRAKASHSELVARAJ\\Blockchain\\Home Depot\\Development\\chaincode_0901\\src\\contracts\\purchase-order.contract.ts";var hash="ba43f91d797abf95c8d552cf90027f79b7a6a2d2";var global=new Function("return this")();var gcv="__coverage__";var coverageData={path:"C:\\Users\\PRAKASHSELVARAJ\\Blockchain\\Home Depot\\Development\\chaincode_0901\\src\\contracts\\purchase-order.contract.ts",statementMap:{"0":{start:{line:2,column:17},end:{line:7,column:1}},"1":{start:{line:3,column:12},end:{line:3,column:28}},"2":{start:{line:3,column:34},end:{line:3,column:125}},"3":{start:{line:4,column:4},end:{line:5,column:150}},"4":{start:{line:4,column:79},end:{line:4,column:131}},"5":{start:{line:5,column:9},end:{line:5,column:150}},"6":{start:{line:5,column:22},end:{line:5,column:43}},"7":{start:{line:5,column:58},end:{line:5,column:150}},"8":{start:{line:5,column:81},end:{line:5,column:150}},"9":{start:{line:6,column:4},end:{line:6,column:66}},"10":{start:{line:8,column:17},end:{line:10,column:1}},"11":{start:{line:9,column:4},end:{line:9,column:109}},"12":{start:{line:9,column:79},end:{line:9,column:109}},"13":{start:{line:11,column:0},end:{line:11,column:62}},"14":{start:{line:12,column:30},end:{line:12,column:60}},"15":{start:{line:13,column:17},end:{line:13,column:37}},"16":{start:{line:14,column:23},end:{line:14,column:49}},"17":{start:{line:15,column:28},end:{line:15,column:59}},"18":{start:{line:16,column:15},end:{line:16,column:35}},"19":{start:{line:17,column:15},end:{line:17,column:73}},"20":{start:{line:18,column:28},end:{line:157,column:1}},"21":{start:{line:19,column:20},end:{line:19,column:77}},"22":{start:{line:22,column:8},end:{line:39,column:9}},"23":{start:{line:24,column:12},end:{line:26,column:13}},"24":{start:{line:25,column:16},end:{line:25,column:91}},"25":{start:{line:28,column:22},end:{line:28,column:24}},"26":{start:{line:29,column:12},end:{line:32,column:13}},"27":{start:{line:30,column:36},end:{line:30,column:100}},"28":{start:{line:31,column:16},end:{line:31,column:40}},"29":{start:{line:33,column:12},end:{line:33,column:23}},"30":{start:{line:36,column:12},end:{line:36,column:58}},"31":{start:{line:37,column:12},end:{line:37,column:28}},"32":{start:{line:38,column:12},end:{line:38,column:19}},"33":{start:{line:43,column:8},end:{line:155,column:9}},"34":{start:{line:45,column:12},end:{line:45,column:39}},"35":{start:{line:46,column:12},end:{line:48,column:13}},"36":{start:{line:47,column:16},end:{line:47,column:119}},"37":{start:{line:49,column:12},end:{line:51,column:13}},"38":{start:{line:49,column:57},end:{line:49,column:89}},"39":{start:{line:50,column:16},end:{line:50,column:133}},"40":{start:{line:52,column:25},end:{line:52,column:75}},"41":{start:{line:54,column:21},end:{line:54,column:74}},"42":{start:{line:55,column:26},end:{line:55,column:30}},"43":{start:{line:56,column:12},end:{line:62,column:13}},"44":{start:{line:57,column:16},end:{line:57,column:60}},"45":{start:{line:58,column:16},end:{line:58,column:48}},"46":{start:{line:59,column:16},end:{line:59,column:32}},"47":{start:{line:60,column:16},end:{line:60,column:58}},"48":{start:{line:61,column:16},end:{line:61,column:55}},"49":{start:{line:64,column:12},end:{line:64,column:61}},"50":{start:{line:65,column:26},end:{line:65,column:91}},"51":{start:{line:66,column:12},end:{line:68,column:13}},"52":{start:{line:67,column:16},end:{line:67,column:72}},"53":{start:{line:69,column:12},end:{line:69,column:47}},"54":{start:{line:71,column:12},end:{line:71,column:62}},"55":{start:{line:72,column:30},end:{line:72,column:89}},"56":{start:{line:73,column:12},end:{line:75,column:13}},"57":{start:{line:74,column:16},end:{line:74,column:70}},"58":{start:{line:76,column:12},end:{line:76,column:51}},"59":{start:{line:78,column:12},end:{line:78,column:151}},"60":{start:{line:79,column:12},end:{line:112,column:13}},"61":{start:{line:81,column:16},end:{line:81,column:96}},"62":{start:{line:82,column:16},end:{line:90,column:19}},"63":{start:{line:83,column:46},end:{line:85,column:22}},"64":{start:{line:84,column:24},end:{line:84,column:224}},"65":{start:{line:86,column:20},end:{line:89,column:21}},"66":{start:{line:87,column:24},end:{line:87,column:84}},"67":{start:{line:88,column:24},end:{line:88,column:68}},"68":{start:{line:92,column:32},end:{line:101,column:22}},"69":{start:{line:93,column:46},end:{line:95,column:22}},"70":{start:{line:94,column:24},end:{line:94,column:224}},"71":{start:{line:96,column:20},end:{line:99,column:21}},"72":{start:{line:97,column:24},end:{line:97,column:93}},"73":{start:{line:98,column:24},end:{line:98,column:37}},"74":{start:{line:100,column:20},end:{line:100,column:31}},"75":{start:{line:102,column:16},end:{line:102,column:93}},"76":{start:{line:104,column:16},end:{line:107,column:17}},"77":{start:{line:105,column:20},end:{line:105,column:100}},"78":{start:{line:106,column:20},end:{line:106,column:57}},"79":{start:{line:110,column:16},end:{line:110,column:84}},"80":{start:{line:111,column:16},end:{line:111,column:93}},"81":{start:{line:114,column:31},end:{line:119,column:18}},"82":{start:{line:115,column:16},end:{line:117,column:17}},"83":{start:{line:115,column:50},end:{line:115,column:96}},"84":{start:{line:116,column:20},end:{line:116,column:59}},"85":{start:{line:118,column:16},end:{line:118,column:25}},"86":{start:{line:120,column:12},end:{line:126,column:13}},"87":{start:{line:121,column:35},end:{line:121,column:169}},"88":{start:{line:122,column:16},end:{line:124,column:19}},"89":{start:{line:123,column:20},end:{line:123,column:75}},"90":{start:{line:125,column:16},end:{line:125,column:46}},"91":{start:{line:128,column:12},end:{line:128,column:71}},"92":{start:{line:129,column:12},end:{line:134,column:15}},"93":{start:{line:130,column:35},end:{line:130,column:105}},"94":{start:{line:130,column:77},end:{line:130,column:102}},"95":{start:{line:131,column:16},end:{line:133,column:17}},"96":{start:{line:132,column:20},end:{line:132,column:76}},"97":{start:{line:136,column:12},end:{line:136,column:59}},"98":{start:{line:137,column:28},end:{line:137,column:110}},"99":{start:{line:138,column:12},end:{line:138,column:59}},"100":{start:{line:140,column:12},end:{line:147,column:13}},"101":{start:{line:141,column:16},end:{line:141,column:62}},"102":{start:{line:142,column:16},end:{line:142,column:47}},"103":{start:{line:145,column:16},end:{line:145,column:68}},"104":{start:{line:146,column:16},end:{line:146,column:47}},"105":{start:{line:148,column:12},end:{line:148,column:128}},"106":{start:{line:149,column:12},end:{line:149,column:29}},"107":{start:{line:152,column:12},end:{line:152,column:78}},"108":{start:{line:153,column:12},end:{line:153,column:28}},"109":{start:{line:154,column:12},end:{line:154,column:19}},"110":{start:{line:158,column:0},end:{line:165,column:68}},"111":{start:{line:166,column:0},end:{line:174,column:63}},"112":{start:{line:175,column:0},end:{line:178,column:26}},"113":{start:{line:179,column:0},end:{line:179,column:54}}},fnMap:{"0":{name:"(anonymous_0)",decl:{start:{line:2,column:46},end:{line:2,column:47}},loc:{start:{line:2,column:87},end:{line:7,column:1}},line:2},"1":{name:"(anonymous_1)",decl:{start:{line:8,column:46},end:{line:8,column:47}},loc:{start:{line:8,column:62},end:{line:10,column:1}},line:8},"2":{name:"(anonymous_2)",decl:{start:{line:19,column:4},end:{line:19,column:5}},loc:{start:{line:19,column:18},end:{line:19,column:79}},line:19},"3":{name:"(anonymous_3)",decl:{start:{line:21,column:4},end:{line:21,column:5}},loc:{start:{line:21,column:67},end:{line:40,column:5}},line:21},"4":{name:"(anonymous_4)",decl:{start:{line:42,column:4},end:{line:42,column:5}},loc:{start:{line:42,column:65},end:{line:156,column:5}},line:42},"5":{name:"(anonymous_5)",decl:{start:{line:49,column:42},end:{line:49,column:43}},loc:{start:{line:49,column:55},end:{line:49,column:91}},line:49},"6":{name:"(anonymous_6)",decl:{start:{line:82,column:45},end:{line:82,column:46}},loc:{start:{line:82,column:61},end:{line:90,column:17}},line:82},"7":{name:"(anonymous_7)",decl:{start:{line:83,column:74},end:{line:83,column:75}},loc:{start:{line:83,column:105},end:{line:85,column:21}},line:83},"8":{name:"(anonymous_8)",decl:{start:{line:92,column:60},end:{line:92,column:61}},loc:{start:{line:92,column:81},end:{line:101,column:17}},line:92},"9":{name:"(anonymous_9)",decl:{start:{line:93,column:74},end:{line:93,column:75}},loc:{start:{line:93,column:105},end:{line:95,column:21}},line:93},"10":{name:"(anonymous_10)",decl:{start:{line:114,column:56},end:{line:114,column:57}},loc:{start:{line:114,column:72},end:{line:119,column:13}},line:114},"11":{name:"(anonymous_11)",decl:{start:{line:115,column:32},end:{line:115,column:33}},loc:{start:{line:115,column:48},end:{line:115,column:98}},line:115},"12":{name:"(anonymous_12)",decl:{start:{line:122,column:37},end:{line:122,column:38}},loc:{start:{line:122,column:50},end:{line:124,column:17}},line:122},"13":{name:"(anonymous_13)",decl:{start:{line:129,column:38},end:{line:129,column:39}},loc:{start:{line:129,column:51},end:{line:134,column:13}},line:129},"14":{name:"(anonymous_14)",decl:{start:{line:130,column:59},end:{line:130,column:60}},loc:{start:{line:130,column:75},end:{line:130,column:104}},line:130}},branchMap:{"0":{loc:{start:{line:2,column:17},end:{line:7,column:1}},type:"binary-expr",locations:[{start:{line:2,column:18},end:{line:2,column:22}},{start:{line:2,column:26},end:{line:2,column:41}},{start:{line:2,column:46},end:{line:7,column:1}}],line:2},"1":{loc:{start:{line:3,column:34},end:{line:3,column:125}},type:"cond-expr",locations:[{start:{line:3,column:42},end:{line:3,column:48}},{start:{line:3,column:51},end:{line:3,column:125}}],line:3},"2":{loc:{start:{line:3,column:51},end:{line:3,column:125}},type:"cond-expr",locations:[{start:{line:3,column:67},end:{line:3,column:118}},{start:{line:3,column:121},end:{line:3,column:125}}],line:3},"3":{loc:{start:{line:4,column:4},end:{line:5,column:150}},type:"if",locations:[{start:{line:4,column:4},end:{line:5,column:150}},{start:{line:4,column:4},end:{line:5,column:150}}],line:4},"4":{loc:{start:{line:4,column:8},end:{line:4,column:77}},type:"binary-expr",locations:[{start:{line:4,column:8},end:{line:4,column:35}},{start:{line:4,column:39},end:{line:4,column:77}}],line:4},"5":{loc:{start:{line:5,column:58},end:{line:5,column:150}},type:"if",locations:[{start:{line:5,column:58},end:{line:5,column:150}},{start:{line:5,column:58},end:{line:5,column:150}}],line:5},"6":{loc:{start:{line:5,column:85},end:{line:5,column:149}},type:"binary-expr",locations:[{start:{line:5,column:86},end:{line:5,column:143}},{start:{line:5,column:148},end:{line:5,column:149}}],line:5},"7":{loc:{start:{line:5,column:86},end:{line:5,column:143}},type:"cond-expr",locations:[{start:{line:5,column:94},end:{line:5,column:98}},{start:{line:5,column:101},end:{line:5,column:143}}],line:5},"8":{loc:{start:{line:5,column:101},end:{line:5,column:143}},type:"cond-expr",locations:[{start:{line:5,column:109},end:{line:5,column:126}},{start:{line:5,column:129},end:{line:5,column:143}}],line:5},"9":{loc:{start:{line:6,column:11},end:{line:6,column:62}},type:"binary-expr",locations:[{start:{line:6,column:11},end:{line:6,column:16}},{start:{line:6,column:20},end:{line:6,column:21}},{start:{line:6,column:25},end:{line:6,column:62}}],line:6},"10":{loc:{start:{line:8,column:17},end:{line:10,column:1}},type:"binary-expr",locations:[{start:{line:8,column:18},end:{line:8,column:22}},{start:{line:8,column:26},end:{line:8,column:41}},{start:{line:8,column:46},end:{line:10,column:1}}],line:8},"11":{loc:{start:{line:9,column:4},end:{line:9,column:109}},type:"if",locations:[{start:{line:9,column:4},end:{line:9,column:109}},{start:{line:9,column:4},end:{line:9,column:109}}],line:9},"12":{loc:{start:{line:9,column:8},end:{line:9,column:77}},type:"binary-expr",locations:[{start:{line:9,column:8},end:{line:9,column:35}},{start:{line:9,column:39},end:{line:9,column:77}}],line:9},"13":{loc:{start:{line:24,column:12},end:{line:26,column:13}},type:"if",locations:[{start:{line:24,column:12},end:{line:26,column:13}},{start:{line:24,column:12},end:{line:26,column:13}}],line:24},"14":{loc:{start:{line:46,column:12},end:{line:48,column:13}},type:"if",locations:[{start:{line:46,column:12},end:{line:48,column:13}},{start:{line:46,column:12},end:{line:48,column:13}}],line:46},"15":{loc:{start:{line:49,column:12},end:{line:51,column:13}},type:"if",locations:[{start:{line:49,column:12},end:{line:51,column:13}},{start:{line:49,column:12},end:{line:51,column:13}}],line:49},"16":{loc:{start:{line:56,column:12},end:{line:62,column:13}},type:"if",locations:[{start:{line:56,column:12},end:{line:62,column:13}},{start:{line:56,column:12},end:{line:62,column:13}}],line:56},"17":{loc:{start:{line:66,column:12},end:{line:68,column:13}},type:"if",locations:[{start:{line:66,column:12},end:{line:68,column:13}},{start:{line:66,column:12},end:{line:68,column:13}}],line:66},"18":{loc:{start:{line:73,column:12},end:{line:75,column:13}},type:"if",locations:[{start:{line:73,column:12},end:{line:75,column:13}},{start:{line:73,column:12},end:{line:75,column:13}}],line:73},"19":{loc:{start:{line:78,column:34},end:{line:78,column:124}},type:"cond-expr",locations:[{start:{line:78,column:102},end:{line:78,column:108}},{start:{line:78,column:111},end:{line:78,column:124}}],line:78},"20":{loc:{start:{line:78,column:35},end:{line:78,column:98}},type:"binary-expr",locations:[{start:{line:78,column:35},end:{line:78,column:66}},{start:{line:78,column:70},end:{line:78,column:98}}],line:78},"21":{loc:{start:{line:79,column:12},end:{line:112,column:13}},type:"if",locations:[{start:{line:79,column:12},end:{line:112,column:13}},{start:{line:79,column:12},end:{line:112,column:13}}],line:79},"22":{loc:{start:{line:79,column:16},end:{line:79,column:79}},type:"binary-expr",locations:[{start:{line:79,column:16},end:{line:79,column:47}},{start:{line:79,column:51},end:{line:79,column:79}}],line:79},"23":{loc:{start:{line:84,column:31},end:{line:84,column:223}},type:"binary-expr",locations:[{start:{line:84,column:31},end:{line:84,column:56}},{start:{line:84,column:60},end:{line:84,column:81}},{start:{line:84,column:85},end:{line:84,column:106}},{start:{line:84,column:110},end:{line:84,column:139}},{start:{line:84,column:143},end:{line:84,column:174}},{start:{line:84,column:178},end:{line:84,column:223}}],line:84},"24":{loc:{start:{line:86,column:20},end:{line:89,column:21}},type:"if",locations:[{start:{line:86,column:20},end:{line:89,column:21}},{start:{line:86,column:20},end:{line:89,column:21}}],line:86},"25":{loc:{start:{line:94,column:31},end:{line:94,column:223}},type:"binary-expr",locations:[{start:{line:94,column:31},end:{line:94,column:56}},{start:{line:94,column:60},end:{line:94,column:81}},{start:{line:94,column:85},end:{line:94,column:106}},{start:{line:94,column:110},end:{line:94,column:139}},{start:{line:94,column:143},end:{line:94,column:174}},{start:{line:94,column:178},end:{line:94,column:223}}],line:94},"26":{loc:{start:{line:96,column:20},end:{line:99,column:21}},type:"if",locations:[{start:{line:96,column:20},end:{line:99,column:21}},{start:{line:96,column:20},end:{line:99,column:21}}],line:96},"27":{loc:{start:{line:104,column:16},end:{line:107,column:17}},type:"if",locations:[{start:{line:104,column:16},end:{line:107,column:17}},{start:{line:104,column:16},end:{line:107,column:17}}],line:104},"28":{loc:{start:{line:115,column:16},end:{line:117,column:17}},type:"if",locations:[{start:{line:115,column:16},end:{line:117,column:17}},{start:{line:115,column:16},end:{line:117,column:17}}],line:115},"29":{loc:{start:{line:115,column:57},end:{line:115,column:95}},type:"binary-expr",locations:[{start:{line:115,column:57},end:{line:115,column:76}},{start:{line:115,column:80},end:{line:115,column:95}}],line:115},"30":{loc:{start:{line:120,column:12},end:{line:126,column:13}},type:"if",locations:[{start:{line:120,column:12},end:{line:126,column:13}},{start:{line:120,column:12},end:{line:126,column:13}}],line:120},"31":{loc:{start:{line:131,column:16},end:{line:133,column:17}},type:"if",locations:[{start:{line:131,column:16},end:{line:133,column:17}},{start:{line:131,column:16},end:{line:133,column:17}}],line:131},"32":{loc:{start:{line:131,column:20},end:{line:131,column:97}},type:"binary-expr",locations:[{start:{line:131,column:20},end:{line:131,column:37}},{start:{line:131,column:41},end:{line:131,column:97}}],line:131},"33":{loc:{start:{line:140,column:12},end:{line:147,column:13}},type:"if",locations:[{start:{line:140,column:12},end:{line:147,column:13}},{start:{line:140,column:12},end:{line:147,column:13}}],line:140}},s:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0,"29":0,"30":0,"31":0,"32":0,"33":0,"34":0,"35":0,"36":0,"37":0,"38":0,"39":0,"40":0,"41":0,"42":0,"43":0,"44":0,"45":0,"46":0,"47":0,"48":0,"49":0,"50":0,"51":0,"52":0,"53":0,"54":0,"55":0,"56":0,"57":0,"58":0,"59":0,"60":0,"61":0,"62":0,"63":0,"64":0,"65":0,"66":0,"67":0,"68":0,"69":0,"70":0,"71":0,"72":0,"73":0,"74":0,"75":0,"76":0,"77":0,"78":0,"79":0,"80":0,"81":0,"82":0,"83":0,"84":0,"85":0,"86":0,"87":0,"88":0,"89":0,"90":0,"91":0,"92":0,"93":0,"94":0,"95":0,"96":0,"97":0,"98":0,"99":0,"100":0,"101":0,"102":0,"103":0,"104":0,"105":0,"106":0,"107":0,"108":0,"109":0,"110":0,"111":0,"112":0,"113":0},f:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0},b:{"0":[0,0,0],"1":[0,0],"2":[0,0],"3":[0,0],"4":[0,0],"5":[0,0],"6":[0,0],"7":[0,0],"8":[0,0],"9":[0,0,0],"10":[0,0,0],"11":[0,0],"12":[0,0],"13":[0,0],"14":[0,0],"15":[0,0],"16":[0,0],"17":[0,0],"18":[0,0],"19":[0,0],"20":[0,0],"21":[0,0],"22":[0,0],"23":[0,0,0,0,0,0],"24":[0,0],"25":[0,0,0,0,0,0],"26":[0,0],"27":[0,0],"28":[0,0],"29":[0,0],"30":[0,0],"31":[0,0],"32":[0,0],"33":[0,0]},_coverageSchema:"43e27e138ebf9cfc5966b082cf9a028302ed4184",hash:"ba43f91d797abf95c8d552cf90027f79b7a6a2d2"};var coverage=global[gcv]||(global[gcv]={});if(coverage[path]&&coverage[path].hash===hash){return coverage[path];}return coverage[path]=coverageData;}();var __decorate=(cov_202xh21jbv.s[0]++,(cov_202xh21jbv.b[0][0]++,this)&&(cov_202xh21jbv.b[0][1]++,this.__decorate)||(cov_202xh21jbv.b[0][2]++,function(decorators,target,key,desc){cov_202xh21jbv.f[0]++;var c=(cov_202xh21jbv.s[1]++,arguments.length),r=(cov_202xh21jbv.s[2]++,c<3?(cov_202xh21jbv.b[1][0]++,target):(cov_202xh21jbv.b[1][1]++,desc===null?(cov_202xh21jbv.b[2][0]++,desc=Object.getOwnPropertyDescriptor(target,key)):(cov_202xh21jbv.b[2][1]++,desc))),d;cov_202xh21jbv.s[3]++;if((cov_202xh21jbv.b[4][0]++,typeof Reflect==="object")&&(cov_202xh21jbv.b[4][1]++,typeof Reflect.decorate==="function")){cov_202xh21jbv.b[3][0]++;cov_202xh21jbv.s[4]++;r=Reflect.decorate(decorators,target,key,desc);}else{cov_202xh21jbv.b[3][1]++;cov_202xh21jbv.s[5]++;for(var i=(cov_202xh21jbv.s[6]++,decorators.length-1);i>=0;i--){cov_202xh21jbv.s[7]++;if(d=decorators[i]){cov_202xh21jbv.b[5][0]++;cov_202xh21jbv.s[8]++;r=(cov_202xh21jbv.b[6][0]++,c<3?(cov_202xh21jbv.b[7][0]++,d(r)):(cov_202xh21jbv.b[7][1]++,c>3?(cov_202xh21jbv.b[8][0]++,d(target,key,r)):(cov_202xh21jbv.b[8][1]++,d(target,key))))||(cov_202xh21jbv.b[6][1]++,r);}else{cov_202xh21jbv.b[5][1]++;}}}cov_202xh21jbv.s[9]++;return(cov_202xh21jbv.b[9][0]++,c>3)&&(cov_202xh21jbv.b[9][1]++,r)&&(cov_202xh21jbv.b[9][2]++,Object.defineProperty(target,key,r)),r;}));var __metadata=(cov_202xh21jbv.s[10]++,(cov_202xh21jbv.b[10][0]++,this)&&(cov_202xh21jbv.b[10][1]++,this.__metadata)||(cov_202xh21jbv.b[10][2]++,function(k,v){cov_202xh21jbv.f[1]++;cov_202xh21jbv.s[11]++;if((cov_202xh21jbv.b[12][0]++,typeof Reflect==="object")&&(cov_202xh21jbv.b[12][1]++,typeof Reflect.metadata==="function")){cov_202xh21jbv.b[11][0]++;cov_202xh21jbv.s[12]++;return Reflect.metadata(k,v);}else{cov_202xh21jbv.b[11][1]++;}}));cov_202xh21jbv.s[13]++;Object.defineProperty(exports,"__esModule",{value:true});const fabric_contract_api_1=(cov_202xh21jbv.s[14]++,require("fabric-contract-api"));const models_1=(cov_202xh21jbv.s[15]++,require("../models"));const repositories_1=(cov_202xh21jbv.s[16]++,require("../repositories"));const processing_engine_1=(cov_202xh21jbv.s[17]++,require("../processing-engine"));const Logger=(cov_202xh21jbv.s[18]++,require('../logger'));const logger=(cov_202xh21jbv.s[19]++,Logger.getLogger('./contracts/purchase-order.contract.ts'));cov_202xh21jbv.s[20]++;let PurchaseOrderContract=class PurchaseOrderContract extends fabric_contract_api_1.Contract{constructor(){cov_202xh21jbv.f[2]++;cov_202xh21jbv.s[21]++;super("com.homedepot.procurement.PurchaseOrderContract");}// Used to bulk merge several PurchaseOrders of new PurchaseOrder data with existing PurchaseOrder data
async bulkSavePurchaseOrders(ctx,newListOfPurchaseOrderLists){cov_202xh21jbv.f[3]++;cov_202xh21jbv.s[22]++;try{cov_202xh21jbv.s[23]++;// Sanity-checks: polist.length > 0
if(newListOfPurchaseOrderLists.length===0){cov_202xh21jbv.b[13][0]++;cov_202xh21jbv.s[24]++;throw new Error(`bulkSavePurchaseOrders was called with 0 PurchaseOrders`);}else{cov_202xh21jbv.b[13][1]++;}// Add each set of PO items to the blockchain, one PONumber at a time
let aps=(cov_202xh21jbv.s[25]++,[]);cov_202xh21jbv.s[26]++;for(let poList of newListOfPurchaseOrderLists){let currentSaveAP=(cov_202xh21jbv.s[27]++,await this.savePurchaseOrder(ctx,poList.PONumber,poList.Items));cov_202xh21jbv.s[28]++;aps.push(currentSaveAP);}cov_202xh21jbv.s[29]++;return aps;}catch(e){cov_202xh21jbv.s[30]++;logger.error(`bulkSavePurchaseOrders failed`);cov_202xh21jbv.s[31]++;logger.error(e);cov_202xh21jbv.s[32]++;return;}}// Used to merge new PurchaseOrder data with existing PurchaseOrder data
async savePurchaseOrder(ctx,poNumber,newPurchaseOrderList){cov_202xh21jbv.f[4]++;cov_202xh21jbv.s[33]++;try{cov_202xh21jbv.s[34]++;// Sanity-checks: polist.length > 0, all items in polist have PONumber=poNumber
poNumber=poNumber.trim();cov_202xh21jbv.s[35]++;if(newPurchaseOrderList.length===0){cov_202xh21jbv.b[14][0]++;cov_202xh21jbv.s[36]++;throw new Error(`savePurchaseOrder was called with 0 PurchaseOrder items, for PONumber '${poNumber}'`);}else{cov_202xh21jbv.b[14][1]++;}cov_202xh21jbv.s[37]++;if(newPurchaseOrderList.some((v,i,l)=>{cov_202xh21jbv.f[5]++;cov_202xh21jbv.s[38]++;return v.PONumber!=poNumber;})){cov_202xh21jbv.b[15][0]++;cov_202xh21jbv.s[39]++;throw new Error(`savePurchaseOrder was called with some PurchaseOrder items that do not have PONUmber '${poNumber}`);}else{cov_202xh21jbv.b[15][1]++;}let apRepo=(cov_202xh21jbv.s[40]++,new repositories_1.AssetProcurementRepository(ctx));// Retrieve or create the AssetProcurement record
let ap=(cov_202xh21jbv.s[41]++,new models_1.AssetProcurement({PONumber:poNumber}));let apIsNew=(cov_202xh21jbv.s[42]++,true);cov_202xh21jbv.s[43]++;if((await apRepo.exists(poNumber))==true){cov_202xh21jbv.b[16][0]++;cov_202xh21jbv.s[44]++;logger.debug(`PONumber ${poNumber} exists`);cov_202xh21jbv.s[45]++;ap=await apRepo.get(poNumber);cov_202xh21jbv.s[46]++;apIsNew=false;cov_202xh21jbv.s[47]++;logger.debug('Retreived AP from storage');cov_202xh21jbv.s[48]++;logger.debug(ap.PurchaseOrders.length);}else{cov_202xh21jbv.b[16][1]++;}// Get the list of UnitOfMeasure data
cov_202xh21jbv.s[49]++;logger.debug('Retrieving UOM data from storage');let uomList=(cov_202xh21jbv.s[50]++,await new repositories_1.UnitOfMeasureListRepository(ctx).get());cov_202xh21jbv.s[51]++;if(uomList===undefined){cov_202xh21jbv.b[17][0]++;cov_202xh21jbv.s[52]++;uomList=new models_1.UnitOfMeasureList({Items:[]});}else{cov_202xh21jbv.b[17][1]++;}cov_202xh21jbv.s[53]++;logger.debug(uomList.Items.length);// Retrieve the current ADR Rule data
cov_202xh21jbv.s[54]++;logger.debug('Retrieving ADR Rules from storage');let adrRuleList=(cov_202xh21jbv.s[55]++,await new repositories_1.ADRRuleListRepository(ctx).get());cov_202xh21jbv.s[56]++;if(adrRuleList===undefined){cov_202xh21jbv.b[18][0]++;cov_202xh21jbv.s[57]++;adrRuleList=new models_1.ADRRuleList({Items:[]});}else{cov_202xh21jbv.b[18][1]++;}cov_202xh21jbv.s[58]++;logger.debug(adrRuleList.Items.length);// Merge the existing PurchaseOrder data with the new data
cov_202xh21jbv.s[59]++;logger.debug('We '+((cov_202xh21jbv.b[20][0]++,ap.PurchaseOrders!==undefined)&&(cov_202xh21jbv.b[20][1]++,ap.PurchaseOrders.length>0)?(cov_202xh21jbv.b[19][0]++,'have'):(cov_202xh21jbv.b[19][1]++,'do not have'))+' PO data for the AP');cov_202xh21jbv.s[60]++;if((cov_202xh21jbv.b[22][0]++,ap.PurchaseOrders!==undefined)&&(cov_202xh21jbv.b[22][1]++,ap.PurchaseOrders.length>0)){cov_202xh21jbv.b[21][0]++;cov_202xh21jbv.s[61]++;// Merge any records that match on key identifier fields
logger.debug(`Starting with ${newPurchaseOrderList.length} new PurchaseOrders`);cov_202xh21jbv.s[62]++;newPurchaseOrderList.forEach((vc,ic,lc)=>{cov_202xh21jbv.f[6]++;let existingRecordIndex=(cov_202xh21jbv.s[63]++,ap.PurchaseOrders.findIndex((innerVC,innerIC,innerLC)=>{cov_202xh21jbv.f[7]++;cov_202xh21jbv.s[64]++;return(cov_202xh21jbv.b[23][0]++,vc.IFCDC==innerVC.IFCDC)&&(cov_202xh21jbv.b[23][1]++,vc.RDC==innerVC.RDC)&&(cov_202xh21jbv.b[23][2]++,vc.SKU==innerVC.SKU)&&(cov_202xh21jbv.b[23][3]++,vc.SKUGTIN==innerVC.SKUGTIN)&&(cov_202xh21jbv.b[23][4]++,vc.Quantity==innerVC.Quantity)&&(cov_202xh21jbv.b[23][5]++,vc.CreatedDateTime==innerVC.CreatedDateTime);}));cov_202xh21jbv.s[65]++;if(existingRecordIndex>-1){cov_202xh21jbv.b[24][0]++;cov_202xh21jbv.s[66]++;logger.debug('Found a new PO that matched an existing one');cov_202xh21jbv.s[67]++;ap.PurchaseOrders[existingRecordIndex]=vc;}else{cov_202xh21jbv.b[24][1]++;}});// Deterimine all records that are new and do not match any existing records
let uniquePOs=(cov_202xh21jbv.s[68]++,newPurchaseOrderList.reduce((pac,vc,ic,lc)=>{cov_202xh21jbv.f[8]++;let existingRecordIndex=(cov_202xh21jbv.s[69]++,ap.PurchaseOrders.findIndex((innerVC,innerIC,innerLC)=>{cov_202xh21jbv.f[9]++;cov_202xh21jbv.s[70]++;return(cov_202xh21jbv.b[25][0]++,vc.IFCDC==innerVC.IFCDC)&&(cov_202xh21jbv.b[25][1]++,vc.RDC==innerVC.RDC)&&(cov_202xh21jbv.b[25][2]++,vc.SKU==innerVC.SKU)&&(cov_202xh21jbv.b[25][3]++,vc.SKUGTIN==innerVC.SKUGTIN)&&(cov_202xh21jbv.b[25][4]++,vc.Quantity==innerVC.Quantity)&&(cov_202xh21jbv.b[25][5]++,vc.CreatedDateTime==innerVC.CreatedDateTime);}));cov_202xh21jbv.s[71]++;if(existingRecordIndex==-1){cov_202xh21jbv.b[26][0]++;cov_202xh21jbv.s[72]++;logger.debug('Found a new PO that does not match the existing ones');cov_202xh21jbv.s[73]++;pac.push(vc);}else{cov_202xh21jbv.b[26][1]++;}cov_202xh21jbv.s[74]++;return pac;},[]));cov_202xh21jbv.s[75]++;logger.debug(`Ended up with ${uniquePOs.length} totally new PurchaseOrders`);// If we found some new records to add, Append new records to the existing ones
cov_202xh21jbv.s[76]++;if(uniquePOs.length>0){cov_202xh21jbv.b[27][0]++;cov_202xh21jbv.s[77]++;logger.debug('Adding the final list of unique POs to the existing list of POs');cov_202xh21jbv.s[78]++;ap.PurchaseOrders.push(...uniquePOs);}else{cov_202xh21jbv.b[27][1]++;}}else{cov_202xh21jbv.b[21][1]++;cov_202xh21jbv.s[79]++;logger.debug('Adding all new POs since there are no existing POs.');cov_202xh21jbv.s[80]++;ap.setStageDetails(models_1.StageType.PurchaseOrdered,newPurchaseOrderList);}// Make sure that all PO items are heading to the same IFCDC / RDC
let destinations=(cov_202xh21jbv.s[81]++,ap.PurchaseOrders.reduce((p,v,i,l)=>{cov_202xh21jbv.f[10]++;cov_202xh21jbv.s[82]++;if(p.findIndex((vv,ii,ll)=>{cov_202xh21jbv.f[11]++;cov_202xh21jbv.s[83]++;return(cov_202xh21jbv.b[29][0]++,vv.ifcdc==v.IFCDC)&&(cov_202xh21jbv.b[29][1]++,vv.rdc==v.RDC);})==-1){cov_202xh21jbv.b[28][0]++;cov_202xh21jbv.s[84]++;p.push({ifcdc:v.IFCDC,rdc:v.RDC});}else{cov_202xh21jbv.b[28][1]++;}cov_202xh21jbv.s[85]++;return p;},[]));cov_202xh21jbv.s[86]++;if(destinations.length>1){cov_202xh21jbv.b[30][0]++;let errorMessage=(cov_202xh21jbv.s[87]++,`savePurchaseOrder was called for PONUmber '${poNumber} with some PurchaseOrder items that are being shipped to multiple destinations`);cov_202xh21jbv.s[88]++;destinations.forEach((v,i,l)=>{cov_202xh21jbv.f[12]++;cov_202xh21jbv.s[89]++;errorMessage+=`\nIFCDC : ${v.ifcdc}, RDC : ${v.rdc}`;});cov_202xh21jbv.s[90]++;throw new Error(errorMessage);}else{cov_202xh21jbv.b[30][1]++;}// Make sure the provided PO data descriptions match their UOM descriptions
cov_202xh21jbv.s[91]++;logger.debug('Updating POs to use their UOM descriptions');cov_202xh21jbv.s[92]++;ap.PurchaseOrders.forEach((v,i,l)=>{cov_202xh21jbv.f[13]++;let uomItemIndex=(cov_202xh21jbv.s[93]++,uomList.Items.findIndex((vu,iu,lu)=>{cov_202xh21jbv.f[14]++;cov_202xh21jbv.s[94]++;return vu.SKU==v.SKU;}));cov_202xh21jbv.s[95]++;if((cov_202xh21jbv.b[32][0]++,uomItemIndex>-1)&&(cov_202xh21jbv.b[32][1]++,v.Description!=uomList.Items[uomItemIndex].Description)){cov_202xh21jbv.b[31][0]++;cov_202xh21jbv.s[96]++;v.Description=uomList.Items[uomItemIndex].Description;}else{cov_202xh21jbv.b[31][1]++;}});// Run this through the processing engine (FSM)
cov_202xh21jbv.s[97]++;logger.debug('Starting the processing engine');let updatedAP=(cov_202xh21jbv.s[98]++,processing_engine_1.ProcessingEngine.startProcessing(ap,{uomList,adrRuleList}));cov_202xh21jbv.s[99]++;logger.debug('Finished the processing engine');// Save the AssetProcurement record
cov_202xh21jbv.s[100]++;if(apIsNew){cov_202xh21jbv.b[33][0]++;cov_202xh21jbv.s[101]++;logger.debug('Attempting to create a new AP');cov_202xh21jbv.s[102]++;await apRepo.create(updatedAP);}else{cov_202xh21jbv.b[33][1]++;cov_202xh21jbv.s[103]++;logger.debug('Attempting to update an existing AP');cov_202xh21jbv.s[104]++;await apRepo.update(updatedAP);}cov_202xh21jbv.s[105]++;logger.debug(`savePurchaseOrder saved ${newPurchaseOrderList.length} PurchaseOrder items for PONumber ${poNumber}`);cov_202xh21jbv.s[106]++;return updatedAP;}catch(e){cov_202xh21jbv.s[107]++;logger.error(`savePurchaseOrder failed for PONumber ${poNumber}`);cov_202xh21jbv.s[108]++;logger.error(e);cov_202xh21jbv.s[109]++;return;}}};cov_202xh21jbv.s[110]++;__decorate([fabric_contract_api_1.Transaction(),fabric_contract_api_1.Param("newListOfPurchaseOrderLists","PurchaseOrderList[]"),fabric_contract_api_1.Returns('AssetProcurement[]'),__metadata("design:type",Function),__metadata("design:paramtypes",[fabric_contract_api_1.Context,Array]),__metadata("design:returntype",Promise)],PurchaseOrderContract.prototype,"bulkSavePurchaseOrders",null);cov_202xh21jbv.s[111]++;__decorate([fabric_contract_api_1.Transaction(),fabric_contract_api_1.Param("poNumber","string"),fabric_contract_api_1.Param("newPurchaseOrderList","PurchaseOrder[]"),fabric_contract_api_1.Returns('AssetProcurement'),__metadata("design:type",Function),__metadata("design:paramtypes",[fabric_contract_api_1.Context,String,Array]),__metadata("design:returntype",Promise)],PurchaseOrderContract.prototype,"savePurchaseOrder",null);cov_202xh21jbv.s[112]++;PurchaseOrderContract=__decorate([fabric_contract_api_1.Info({title:'PurchaseOrderContract',description:'Contract for managing the list of PurchaseOrders, and their related discrepancies'}),__metadata("design:paramtypes",[])],PurchaseOrderContract);cov_202xh21jbv.s[113]++;exports.PurchaseOrderContract=PurchaseOrderContract;//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiQzpcXFVzZXJzXFxQUkFLQVNIU0VMVkFSQUpcXEJsb2NrY2hhaW5cXEhvbWUgRGVwb3RcXERldmVsb3BtZW50XFxjaGFpbmNvZGVfMDkwMVxcc3JjXFxjb250cmFjdHNcXHB1cmNoYXNlLW9yZGVyLmNvbnRyYWN0LnRzIiwic291cmNlcyI6WyJDOlxcVXNlcnNcXFBSQUtBU0hTRUxWQVJBSlxcQmxvY2tjaGFpblxcSG9tZSBEZXBvdFxcRGV2ZWxvcG1lbnRcXGNoYWluY29kZV8wOTAxXFxzcmNcXGNvbnRyYWN0c1xccHVyY2hhc2Utb3JkZXIuY29udHJhY3QudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7QUFBQSw2REFBMkY7QUFDM0Ysc0NBQWtKO0FBQ2xKLGtEQUFpSDtBQUNqSCw0REFBd0Q7QUFFeEQsTUFBTSxNQUFNLEdBQUcsT0FBTyxDQUFDLFdBQVcsQ0FBQyxDQUFDO0FBQ3BDLE1BQU0sTUFBTSxHQUFHLE1BQU0sQ0FBQyxTQUFTLENBQUMsd0NBQXdDLENBQUMsQ0FBQztBQUkxRSxJQUFhLHFCQUFxQixHQUFsQyxNQUFhLHFCQUFzQixTQUFRLDhCQUFRO0lBRy9DLGdCQUFnQixLQUFLLENBQUMsaURBQWlELENBQUMsQ0FBQyxDQUFDLENBQUM7SUFHM0UsdUdBQXVHO0lBSWhHLEtBQUssQ0FBQyxzQkFBc0IsQ0FBQyxHQUFZLEVBQUUsMkJBQWdEO1FBQzlGLElBQUk7WUFDQSxtQ0FBbUM7WUFDbkMsSUFBSSwyQkFBMkIsQ0FBQyxNQUFNLEtBQUssQ0FBQyxFQUFDO2dCQUN6QyxNQUFNLElBQUksS0FBSyxDQUFDLHlEQUF5RCxDQUFDLENBQUM7YUFDOUU7WUFFRCxxRUFBcUU7WUFDckUsSUFBSSxHQUFHLEdBQXdCLEVBQUUsQ0FBQztZQUNsQyxLQUFLLElBQUksTUFBTSxJQUFJLDJCQUEyQixFQUFFO2dCQUM1QyxJQUFJLGFBQWEsR0FBc0IsTUFBTSxJQUFJLENBQUMsaUJBQWlCLENBQUMsR0FBRyxFQUFFLE1BQU0sQ0FBQyxRQUFR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QUFDLENBQUM7YUFDbEM7WUFFRCxNQUFNLENBQUMsS0FBSyxDQUFDLDJCQUEyQixvQkFBb0IsQ0FBQyxNQUFNLHFDQUFxQyxRQUFRLEVBQUUsQ0FBQyxDQUFDO1lBQ3BILE9BQU8sU0FBUyxDQUFDO1NBQ3BCO1FBQUMsT0FBTyxDQUFDLEVBQUU7WUFDUixNQUFNLENBQUMsS0FBSyxDQUFDLHlDQUF5QyxRQUFRLEVBQUUsQ0FBQyxDQUFDO1lBQ2xFLE1BQU0sQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUM7WUFDaEIsT0FBTztTQUNWO0lBQ0wsQ0FBQztDQUVKLENBQUE7QUFuSkc7SUFIQyxpQ0FBVyxFQUFFO0lBQ2IsMkJBQUssQ0FBQyw2QkFBNkIsRUFBRSxxQkFBcUIsQ0FBQztJQUMzRCw2QkFBTyxDQUFDLG9CQUFvQixDQUFDOztxQ0FDVyw2QkFBTzs7bUVBb0IvQztBQVFEO0lBSkMsaUNBQVcsRUFBRTtJQUNiLDJCQUFLLENBQUMsVUFBVSxFQUFFLFFBQVEsQ0FBQztJQUMzQiwyQkFBSyxDQUFDLHNCQUFzQixFQUFFLGlCQUFpQixDQUFDO0lBQ2hELDZCQUFPLENBQUMsa0JBQWtCLENBQUM7O3FDQUNRLDZCQUFPOzs4REFxSDFDO0FBM0pRLHFCQUFxQjtJQURqQywwQkFBSSxDQUFDLEVBQUUsS0FBSyxFQUFFLHVCQUF1QixFQUFFLFdBQVcsRUFBRSxtRkFBbUYsRUFBRSxDQUFDOztHQUM5SCxxQkFBcUIsQ0E2SmpDO0FBN0pZLHNEQUFxQiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IENvbnRleHQsIENvbnRyYWN0LCBJbmZvLCBSZXR1cm5zLCBUcmFuc2FjdGlvbiwgUGFyYW0gfSBmcm9tICdmYWJyaWMtY29udHJhY3QtYXBpJztcclxuaW1wb3J0IHsgUHVyY2hhc2VPcmRlciwgQXNzZXRQcm9jdXJlbWVudCwgU3RhZ2VUeXBlLCBVbml0T2ZNZWFzdXJlLCBVbml0T2ZNZWFzdXJlTGlzdCwgQURSUnVsZSwgQURSUnVsZUxpc3QsIFB1cmNoYXNlT3JkZXJMaXN0IH0gZnJvbSBcIi4uL21vZGVsc1wiO1xyXG5pbXBvcnQgeyBBc3NldFByb2N1cmVtZW50UmVwb3NpdG9yeSwgVW5pdE9mTWVhc3VyZUxpc3RSZXBvc2l0b3J5LCBBRFJSdWxlTGlzdFJlcG9zaXRvcnkgfSBmcm9tICcuLi9yZXBvc2l0b3JpZXMnO1xyXG5pbXBvcnQgeyBQcm9jZXNzaW5nRW5naW5lIH0gZnJvbSAnLi4vcHJvY2Vzc2luZy1lbmdpbmUnO1xyXG5cclxuY29uc3QgTG9nZ2VyID0gcmVxdWlyZSgnLi4vbG9nZ2VyJyk7XHJcbmNvbnN0IGxvZ2dlciA9IExvZ2dlci5nZXRMb2dnZXIoJy4vY29udHJhY3RzL3B1cmNoYXNlLW9yZGVyLmNvbnRyYWN0LnRzJyk7XHJcblxyXG5cclxuQEluZm8oeyB0aXRsZTogJ1B1cmNoYXNlT3JkZXJDb250cmFjdCcsIGRlc2NyaXB0aW9uOiAnQ29udHJhY3QgZm9yIG1hbmFnaW5nIHRoZSBsaXN0IG9mIFB1cmNoYXNlT3JkZXJzLCBhbmQgdGhlaXIgcmVsYXRlZCBkaXNjcmVwYW5jaWVzJyB9KVxyXG5leHBvcnQgY2xhc3MgUHVyY2hhc2VPcmRlckNvbnRyYWN0IGV4dGVuZHMgQ29udHJhY3Qge1xyXG5cclxuXHJcbiAgICBjb25zdHJ1Y3RvcigpIHsgc3VwZXIoXCJjb20uaG9tZWRlcG90LnByb2N1cmVtZW50LlB1cmNoYXNlT3JkZXJDb250cmFjdFwiKTsgfVxyXG5cclxuXHJcbiAgICAvLyBVc2VkIHRvIGJ1bGsgbWVyZ2Ugc2V2ZXJhbCBQdXJjaGFzZU9yZGVycyBvZiBuZXcgUHVyY2hhc2VPcmRlciBkYXRhIHdpdGggZXhpc3RpbmcgUHVyY2hhc2VPcmRlciBkYXRhXHJcbiAgICBAVHJhbnNhY3Rpb24oKVxyXG4gICAgQFBhcmFtKFwibmV3TGlzdE9mUHVyY2hhc2VPcmRlckxpc3RzXCIsIFwiUHVyY2hhc2VPcmRlckxpc3RbXVwiKVxyXG4gICAgQFJldHVybnMoJ0Fzc2V0UHJvY3VyZW1lbnRbXScpICAgIFxyXG4gICAgcHVibGljIGFzeW5jIGJ1bGtTYXZlUHVyY2hhc2VPcmRlcnMoY3R4OiBDb250ZXh0LCBuZXdMaXN0T2ZQdXJjaGFzZU9yZGVyTGlzdHM6IFB1cmNoYXNlT3JkZXJMaXN0W10pOiBQcm9taXNlPEFzc2V0UHJvY3VyZW1lbnRbXT4geyAgXHJcbiAgICAgICAgdHJ5IHtcclxuICAgICAgICAgICAgLy8gU2FuaXR5LWNoZWNrczogcG9saXN0Lmxlbmd0aCA+IDBcclxuICAgICAgICAgICAgaWYgKG5ld0xpc3RPZlB1cmNoYXNlT3JkZXJMaXN0cy5sZW5ndGggPT09IDApeyBcclxuICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihgYnVsa1NhdmVQdXJjaGFzZU9yZGVycyB3YXMgY2FsbGVkIHdpdGggMCBQdXJjaGFzZU9yZGVyc2ApO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAvLyBBZGQgZWFjaCBzZXQgb2YgUE8gaXRlbXMgdG8gdGhlIGJsb2NrY2hhaW4sIG9uZSBQT051bWJlciBhdCBhIHRpbWVcclxuICAgICAgICAgICAgbGV0IGFwcyA6IEFzc2V0UHJvY3VyZW1lbnRbXSA9IFtdO1xyXG4gICAgICAgICAgICBmb3IgKGxldCBwb0xpc3Qgb2YgbmV3TGlzdE9mUHVyY2hhc2VPcmRlckxpc3RzKSB7XHJcbiAgICAgICAgICAgICAgICBsZXQgY3VycmVudFNhdmVBUCA6IEFzc2V0UHJvY3VyZW1lbnQgPSBhd2FpdCB0aGlzLnNhdmVQdXJjaGFzZU9yZGVyKGN0eCwgcG9MaXN0LlBPTnVtYmVyLCBwb0xpc3QuSXRlbXMpO1xyXG4gICAgICAgICAgICAgICAgYXBzLnB1c2goY3VycmVudFNhdmVBUCk7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIHJldHVybiBhcHM7XHJcbiAgICAgICAgfSBjYXRjaCAoZSkge1xyXG4gICAgICAgICAgICBsb2dnZXIuZXJyb3IoYGJ1bGtTYXZlUHVyY2hhc2VPcmRlcnMgZmFpbGVkYCk7XHJcbiAgICAgICAgICAgIGxvZ2dlci5lcnJvcihlKTtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcblxyXG4gICAgLy8gVXNlZCB0byBtZXJnZSBuZXcgUHVyY2hhc2VPcmRlciBkYXRhIHdpdGggZXhpc3RpbmcgUHVyY2hhc2VPcmRlciBkYXRhXHJcbiAgICBAVHJhbnNhY3Rpb24oKVxyXG4gICAgQFBhcmFtKFwicG9OdW1iZXJcIiwgXCJzdHJpbmdcIilcclxuICAgIEBQYXJhbShcIm5ld1B1cmNoYXNlT3JkZXJMaXN0XCIsIFwiUHVyY2hhc2VPcmRlcltdXCIpXHJcbiAgICBAUmV0dXJucygnQXNzZXRQcm9jdXJlbWVudCcpICAgIFxyXG4gICAgcHVibGljIGFzeW5jIHNhdmVQdXJjaGFzZU9yZGVyKGN0eDogQ29udGV4dCwgcG9OdW1iZXI6IHN0cmluZywgbmV3UHVyY2hhc2VPcmRlckxpc3Q6IFB1cmNoYXNlT3JkZXJbXSk6IFByb21pc2U8QXNzZXRQcm9jdXJlbWVudD4geyAgXHJcbiAgICAgICAgdHJ5IHtcclxuICAgICAgICAgICAgLy8gU2FuaXR5LWNoZWNrczogcG9saXN0Lmxlbmd0aCA+IDAsIGFsbCBpdGVtcyBpbiBwb2xpc3QgaGF2ZSBQT051bWJlcj1wb051bWJlclxyXG4gICAgICAgICAgICBwb051bWJlciA9IHBvTnVtYmVyLnRyaW0oKTtcclxuICAgICAgICAgICAgaWYgKG5ld1B1cmNoYXNlT3JkZXJMaXN0Lmxlbmd0aCA9PT0gMCl7IFxyXG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBzYXZlUHVyY2hhc2VPcmRlciB3YXMgY2FsbGVkIHdpdGggMCBQdXJjaGFzZU9yZGVyIGl0ZW1zLCBmb3IgUE9OdW1iZXIgJyR7cG9OdW1iZXJ9J2ApO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmIChuZXdQdXJjaGFzZU9yZGVyTGlzdC5zb21lKCh2LGksbCk9PnsgcmV0dXJuICh2LlBPTnVtYmVyICE9IHBvTnVtYmVyKTsgfSkpIHtcclxuICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihgc2F2ZVB1cmNoYXNlT3JkZXIgd2FzIGNhbGxlZCB3aXRoIHNvbWUgUHVyY2hhc2VPcmRlciBpdGVtcyB0aGF0IGRvIG5vdCBoYXZlIFBPTlVtYmVyICcke3BvTnVtYmVyfWApO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBsZXQgYXBSZXBvIDogQXNzZXRQcm9jdXJlbWVudFJlcG9zaXRvcnkgPSBuZXcgQXNzZXRQcm9jdXJlbWVudFJlcG9zaXRvcnkoY3R4KTtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIC8vIFJldHJpZXZlIG9yIGNyZWF0ZSB0aGUgQXNzZXRQcm9jdXJlbWVudCByZWNvcmRcclxuICAgICAgICAgICAgbGV0IGFwIDogQXNzZXRQcm9jdXJlbWVudCA9IG5ldyBBc3NldFByb2N1cmVtZW50KHsgUE9OdW1iZXI6IHBvTnVtYmVyIH0pO1xyXG4gICAgICAgICAgICBsZXQgYXBJc05ldyA6IGJvb2xlYW4gPSB0cnVlO1xyXG4gICAgICAgICAgICBpZiAoYXdhaXQgYXBSZXBvLmV4aXN0cyhwb051bWJlcikgPT0gdHJ1ZSkge1xyXG4gICAgICAgICAgICAgICAgbG9nZ2VyLmRlYnVnKGBQT051bWJlciAke3BvTnVtYmVyfSBleGlzdHNgKTtcclxuICAgICAgICAgICAgICAgIGFwID0gYXdhaXQgYXBSZXBvLmdldChwb051bWJlcik7XHJcbiAgICAgICAgICAgICAgICBhcElzTmV3ID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICBsb2dnZXIuZGVidWcoJ1JldHJlaXZlZCBBUCBmcm9tIHN0b3JhZ2UnKTtcclxuICAgICAgICAgICAgICAgIGxvZ2dlci5kZWJ1ZyhhcC5QdXJjaGFzZU9yZGVycy5sZW5ndGgpO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAvLyBHZXQgdGhlIGxpc3Qgb2YgVW5pdE9mTWVhc3VyZSBkYXRhXHJcbiAgICAgICAgICAgIGxvZ2dlci5kZWJ1ZygnUmV0cmlldmluZyBVT00gZGF0YSBmcm9tIHN0b3JhZ2UnKTtcclxuICAgICAgICAgICAgbGV0IHVvbUxpc3QgOiBVbml0T2ZNZWFzdXJlTGlzdCB8IHVuZGVmaW5lZCA9IGF3YWl0IChuZXcgVW5pdE9mTWVhc3VyZUxpc3RSZXBvc2l0b3J5KGN0eCkpLmdldCgpO1xyXG4gICAgICAgICAgICBpZiAodW9tTGlzdCA9PT0gdW5kZWZpbmVkKXsgdW9tTGlzdCA9IG5ldyBVbml0T2ZNZWFzdXJlTGlzdCh7IEl0ZW1zOiBbXSB9KTsgfVxyXG4gICAgICAgICAgICBsb2dnZXIuZGVidWcodW9tTGlzdC5JdGVtcy5sZW5ndGgpO1xyXG4gICAgICAgIFxyXG4gICAgICAgICAgICAvLyBSZXRyaWV2ZSB0aGUgY3VycmVudCBBRFIgUnVsZSBkYXRhXHJcbiAgICAgICAgICAgIGxvZ2dlci5kZWJ1ZygnUmV0cmlldmluZyBBRFIgUnVsZXMgZnJvbSBzdG9yYWdlJyk7XHJcbiAgICAgICAgICAgIGxldCBhZHJSdWxlTGlzdCA6IEFEUlJ1bGVMaXN0IHwgdW5kZWZpbmVkID0gYXdhaXQgKG5ldyBBRFJSdWxlTGlzdFJlcG9zaXRvcnkoY3R4KSkuZ2V0KCk7XHJcbiAgICAgICAgICAgIGlmIChhZHJSdWxlTGlzdCA9PT0gdW5kZWZpbmVkKXsgYWRyUnVsZUxpc3QgPSBuZXcgQURSUnVsZUxpc3QoeyBJdGVtczogW10gfSk7IH1cclxuICAgICAgICAgICAgbG9nZ2VyLmRlYnVnKGFkclJ1bGVMaXN0Lkl0ZW1zLmxlbmd0aCk7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAvLyBNZXJnZSB0aGUgZXhpc3RpbmcgUHVyY2hhc2VPcmRlciBkYXRhIHdpdGggdGhlIG5ldyBkYXRhXHJcbiAgICAgICAgICAgIGxvZ2dlci5kZWJ1ZygnV2UgJyArICgoYXAuUHVyY2hhc2VPcmRlcnMgIT09IHVuZGVmaW5lZCAmJiBhcC5QdXJjaGFzZU9yZGVycy5sZW5ndGggPiAwKSA/ICdoYXZlJyA6ICdkbyBub3QgaGF2ZScpICsgJyBQTyBkYXRhIGZvciB0aGUgQVAnKTtcclxuICAgICAgICAgICAgaWYgKGFwLlB1cmNoYXNlT3JkZXJzICE9PSB1bmRlZmluZWQgJiYgYXAuUHVyY2hhc2VPcmRlcnMubGVuZ3RoID4gMCkge1xyXG4gICAgICAgICAgICAgICAgLy8gTWVyZ2UgYW55IHJlY29yZHMgdGhhdCBtYXRjaCBvbiBrZXkgaWRlbnRpZmllciBmaWVsZHNcclxuICAgICAgICAgICAgICAgIGxvZ2dlci5kZWJ1ZyhgU3RhcnRpbmcgd2l0aCAke25ld1B1cmNoYXNlT3JkZXJMaXN0Lmxlbmd0aH0gbmV3IFB1cmNoYXNlT3JkZXJzYCk7XHJcbiAgICAgICAgICAgICAgICBuZXdQdXJjaGFzZU9yZGVyTGlzdC5mb3JFYWNoKCh2YyxpYyxsYyk9PntcclxuICAgICAgICAgICAgICAgICAgICBsZXQgZXhpc3RpbmdSZWNvcmRJbmRleCA9IGFwLlB1cmNoYXNlT3JkZXJzIS5maW5kSW5kZXgoKGlubmVyVkMsaW5uZXJJQyxpbm5lckxDKT0+e1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdmMuSUZDREM9PWlubmVyVkMuSUZDREMgJiYgdmMuUkRDPT1pbm5lclZDLlJEQyAmJiB2Yy5TS1UgPT0gaW5uZXJWQy5TS1UgJiYgdmMuU0tVR1RJTiA9PSBpbm5lclZDLlNLVUdUSU4gJiYgdmMuUXVhbnRpdHk9PWlubmVyVkMuUXVhbnRpdHkgJiYgdmMuQ3JlYXRlZERhdGVUaW1lPT1pbm5lclZDLkNyZWF0ZWREYXRlVGltZTtcclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoZXhpc3RpbmdSZWNvcmRJbmRleCA+IC0xKSB7IFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBsb2dnZXIuZGVidWcoJ0ZvdW5kIGEgbmV3IFBPIHRoYXQgbWF0Y2hlZCBhbiBleGlzdGluZyBvbmUnKTsgXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGFwLlB1cmNoYXNlT3JkZXJzIVtleGlzdGluZ1JlY29yZEluZGV4XSA9IHZjO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgICAgIC8vIERldGVyaW1pbmUgYWxsIHJlY29yZHMgdGhhdCBhcmUgbmV3IGFuZCBkbyBub3QgbWF0Y2ggYW55IGV4aXN0aW5nIHJlY29yZHNcclxuICAgICAgICAgICAgICAgIGxldCB1bmlxdWVQT3MgOiBQdXJjaGFzZU9yZGVyW10gPSBuZXdQdXJjaGFzZU9yZGVyTGlzdC5yZWR1Y2UoKHBhYzpQdXJjaGFzZU9yZGVyW10sdmMsaWMsbGMpPT57XHJcbiAgICAgICAgICAgICAgICAgICAgbGV0IGV4aXN0aW5nUmVjb3JkSW5kZXggPSBhcC5QdXJjaGFzZU9yZGVycyEuZmluZEluZGV4KChpbm5lclZDLGlubmVySUMsaW5uZXJMQyk9PntcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHZjLklGQ0RDPT1pbm5lclZDLklGQ0RDICYmIHZjLlJEQz09aW5uZXJWQy5SREMgJiYgdmMuU0tVID09IGlubmVyVkMuU0tVICYmIHZjLlNLVUdUSU4gPT0gaW5uZXJWQy5TS1VHVElOICYmIHZjLlF1YW50aXR5PT1pbm5lclZDLlF1YW50aXR5ICYmIHZjLkNyZWF0ZWREYXRlVGltZT09aW5uZXJWQy5DcmVhdGVkRGF0ZVRpbWU7XHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGV4aXN0aW5nUmVjb3JkSW5kZXggPT0gLTEpIHsgXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGxvZ2dlci5kZWJ1ZygnRm91bmQgYSBuZXcgUE8gdGhhdCBkb2VzIG5vdCBtYXRjaCB0aGUgZXhpc3Rpbmcgb25lcycpOyBcclxuICAgICAgICAgICAgICAgICAgICAgICAgcGFjLnB1c2godmMpOyBcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHBhYztcclxuICAgICAgICAgICAgICAgIH0sIFtdKTtcclxuICAgICAgICAgICAgICAgIGxvZ2dlci5kZWJ1ZyhgRW5kZWQgdXAgd2l0aCAke3VuaXF1ZVBPcy5sZW5ndGh9IHRvdGFsbHkgbmV3IFB1cmNoYXNlT3JkZXJzYCk7XHJcbiAgXHJcbiAgICAgICAgICAgICAgICAvLyBJZiB3ZSBmb3VuZCBzb21lIG5ldyByZWNvcmRzIHRvIGFkZCwgQXBwZW5kIG5ldyByZWNvcmRzIHRvIHRoZSBleGlzdGluZyBvbmVzXHJcbiAgICAgICAgICAgICAgICBpZiAodW5pcXVlUE9zLmxlbmd0aCA+IDApIHtcclxuICAgICAgICAgICAgICAgICAgICBsb2dnZXIuZGVidWcoJ0FkZGluZyB0aGUgZmluYWwgbGlzdCBvZiB1bmlxdWUgUE9zIHRvIHRoZSBleGlzdGluZyBsaXN0IG9mIFBPcycpO1xyXG4gICAgICAgICAgICAgICAgICAgIGFwLlB1cmNoYXNlT3JkZXJzLnB1c2goLi4udW5pcXVlUE9zKTtcclxuICAgICAgICAgICAgICAgIH0gICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgbG9nZ2VyLmRlYnVnKCdBZGRpbmcgYWxsIG5ldyBQT3Mgc2luY2UgdGhlcmUgYXJlIG5vIGV4aXN0aW5nIFBPcy4nKTtcclxuICAgICAgICAgICAgICAgIGFwLnNldFN0YWdlRGV0YWlscyhTdGFnZVR5cGUuUHVyY2hhc2VPcmRlcmVkLCBuZXdQdXJjaGFzZU9yZGVyTGlzdCk7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIC8vIE1ha2Ugc3VyZSB0aGF0IGFsbCBQTyBpdGVtcyBhcmUgaGVhZGluZyB0byB0aGUgc2FtZSBJRkNEQyAvIFJEQ1xyXG4gICAgICAgICAgICBsZXQgZGVzdGluYXRpb25zIDoge2lmY2RjOnN0cmluZyxyZGM6c3RyaW5nfVtdID0gYXAuUHVyY2hhc2VPcmRlcnMucmVkdWNlKChwOntpZmNkYzpzdHJpbmcscmRjOnN0cmluZ31bXSwgdiwgaSwgbCk9PntcclxuICAgICAgICAgICAgICAgIGlmIChwLmZpbmRJbmRleCgodnYsaWksbGwpPT57IHJldHVybiB2di5pZmNkYyA9PSB2LklGQ0RDICYmIHZ2LnJkYyA9PSB2LlJEQzsgfSkgPT0gLTEpIHtcclxuICAgICAgICAgICAgICAgICAgICBwLnB1c2goe2lmY2RjOnYuSUZDREMscmRjOnYuUkRDfSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gcDtcclxuICAgICAgICAgICAgfSwgW10pO1xyXG4gICAgICAgICAgICBpZiAoZGVzdGluYXRpb25zLmxlbmd0aCA+IDEpIHtcclxuICAgICAgICAgICAgICAgIGxldCBlcnJvck1lc3NhZ2UgOiBzdHJpbmcgPSBgc2F2ZVB1cmNoYXNlT3JkZXIgd2FzIGNhbGxlZCBmb3IgUE9OVW1iZXIgJyR7cG9OdW1iZXJ9IHdpdGggc29tZSBQdXJjaGFzZU9yZGVyIGl0ZW1zIHRoYXQgYXJlIGJlaW5nIHNoaXBwZWQgdG8gbXVsdGlwbGUgZGVzdGluYXRpb25zYDtcclxuICAgICAgICAgICAgICAgIGRlc3RpbmF0aW9ucy5mb3JFYWNoKCh2LGksbCk9PntcclxuICAgICAgICAgICAgICAgICAgICBlcnJvck1lc3NhZ2UgKz0gYFxcbklGQ0RDIDogJHt2LmlmY2RjfSwgUkRDIDogJHt2LnJkY31gO1xyXG4gICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihlcnJvck1lc3NhZ2UpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAvLyBNYWtlIHN1cmUgdGhlIHByb3ZpZGVkIFBPIGRhdGEgZGVzY3JpcHRpb25zIG1hdGNoIHRoZWlyIFVPTSBkZXNjcmlwdGlvbnNcclxuICAgICAgICAgICAgbG9nZ2VyLmRlYnVnKCdVcGRhdGluZyBQT3MgdG8gdXNlIHRoZWlyIFVPTSBkZXNjcmlwdGlvbnMnKTtcclxuICAgICAgICAgICAgYXAuUHVyY2hhc2VPcmRlcnMuZm9yRWFjaCgodixpLGwpPT57XHJcbiAgICAgICAgICAgICAgICBsZXQgdW9tSXRlbUluZGV4IDogbnVtYmVyID0gdW9tTGlzdC5JdGVtcy5maW5kSW5kZXgoKHZ1LGl1LGx1KT0+eyByZXR1cm4gKHZ1LlNLVSA9PSB2LlNLVSk7IH0pO1xyXG4gICAgICAgICAgICAgICAgaWYgKHVvbUl0ZW1JbmRleCA+IC0xICYmIHYuRGVzY3JpcHRpb24gIT0gdW9tTGlzdC5JdGVtc1t1b21JdGVtSW5kZXhdLkRlc2NyaXB0aW9uKSB7IHYuRGVzY3JpcHRpb24gPSB1b21MaXN0Lkl0ZW1zW3VvbUl0ZW1JbmRleF0uRGVzY3JpcHRpb247IH1cclxuICAgICAgICAgICAgfSk7IFxyXG5cclxuICAgICAgICAgICAgLy8gUnVuIHRoaXMgdGhyb3VnaCB0aGUgcHJvY2Vzc2luZyBlbmdpbmUgKEZTTSlcclxuICAgICAgICAgICAgbG9nZ2VyLmRlYnVnKCdTdGFydGluZyB0aGUgcHJvY2Vzc2luZyBlbmdpbmUnKTtcclxuICAgICAgICAgICAgbGV0IHVwZGF0ZWRBUCA6IEFzc2V0UHJvY3VyZW1lbnQgPSBQcm9jZXNzaW5nRW5naW5lLnN0YXJ0UHJvY2Vzc2luZyhhcCwgeyB1b21MaXN0LCBhZHJSdWxlTGlzdCB9KTtcclxuICAgICAgICAgICAgbG9nZ2VyLmRlYnVnKCdGaW5pc2hlZCB0aGUgcHJvY2Vzc2luZyBlbmdpbmUnKTtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIC8vIFNhdmUgdGhlIEFzc2V0UHJvY3VyZW1lbnQgcmVjb3JkXHJcbiAgICAgICAgICAgIGlmIChhcElzTmV3KSB7XHJcbiAgICAgICAgICAgICAgICBsb2dnZXIuZGVidWcoJ0F0dGVtcHRpbmcgdG8gY3JlYXRlIGEgbmV3IEFQJyk7XHJcbiAgICAgICAgICAgICAgICBhd2FpdCBhcFJlcG8uY3JlYXRlKHVwZGF0ZWRBUCk7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBsb2dnZXIuZGVidWcoJ0F0dGVtcHRpbmcgdG8gdXBkYXRlIGFuIGV4aXN0aW5nIEFQJyk7XHJcbiAgICAgICAgICAgICAgICBhd2FpdCBhcFJlcG8udXBkYXRlKHVwZGF0ZWRBUCk7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGxvZ2dlci5kZWJ1Zyhgc2F2ZVB1cmNoYXNlT3JkZXIgc2F2ZWQgJHtuZXdQdXJjaGFzZU9yZGVyTGlzdC5sZW5ndGh9IFB1cmNoYXNlT3JkZXIgaXRlbXMgZm9yIFBPTnVtYmVyICR7cG9OdW1iZXJ9YCk7XHJcbiAgICAgICAgICAgIHJldHVybiB1cGRhdGVkQVA7XHJcbiAgICAgICAgfSBjYXRjaCAoZSkge1xyXG4gICAgICAgICAgICBsb2dnZXIuZXJyb3IoYHNhdmVQdXJjaGFzZU9yZGVyIGZhaWxlZCBmb3IgUE9OdW1iZXIgJHtwb051bWJlcn1gKTtcclxuICAgICAgICAgICAgbG9nZ2VyLmVycm9yKGUpO1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxufSJdfQ==