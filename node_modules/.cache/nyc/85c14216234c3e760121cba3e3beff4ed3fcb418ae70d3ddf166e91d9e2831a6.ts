"use strict";var cov_2evwnnbx36=function(){var path="C:\\Users\\PRAKASHSELVARAJ\\Blockchain\\Home Depot\\Development\\chaincode_0901\\src\\contracts\\vendor-shipped.contract.ts";var hash="e0df90663e2cf4291ead61a396a3d141b97cd9b6";var global=new Function("return this")();var gcv="__coverage__";var coverageData={path:"C:\\Users\\PRAKASHSELVARAJ\\Blockchain\\Home Depot\\Development\\chaincode_0901\\src\\contracts\\vendor-shipped.contract.ts",statementMap:{"0":{start:{line:2,column:17},end:{line:7,column:1}},"1":{start:{line:3,column:12},end:{line:3,column:28}},"2":{start:{line:3,column:34},end:{line:3,column:125}},"3":{start:{line:4,column:4},end:{line:5,column:150}},"4":{start:{line:4,column:79},end:{line:4,column:131}},"5":{start:{line:5,column:9},end:{line:5,column:150}},"6":{start:{line:5,column:22},end:{line:5,column:43}},"7":{start:{line:5,column:58},end:{line:5,column:150}},"8":{start:{line:5,column:81},end:{line:5,column:150}},"9":{start:{line:6,column:4},end:{line:6,column:66}},"10":{start:{line:8,column:17},end:{line:10,column:1}},"11":{start:{line:9,column:4},end:{line:9,column:109}},"12":{start:{line:9,column:79},end:{line:9,column:109}},"13":{start:{line:11,column:0},end:{line:11,column:62}},"14":{start:{line:12,column:30},end:{line:12,column:60}},"15":{start:{line:13,column:17},end:{line:13,column:37}},"16":{start:{line:14,column:23},end:{line:14,column:49}},"17":{start:{line:15,column:28},end:{line:15,column:59}},"18":{start:{line:16,column:15},end:{line:16,column:35}},"19":{start:{line:17,column:15},end:{line:17,column:73}},"20":{start:{line:18,column:28},end:{line:141,column:1}},"21":{start:{line:19,column:20},end:{line:19,column:77}},"22":{start:{line:22,column:8},end:{line:39,column:9}},"23":{start:{line:24,column:12},end:{line:26,column:13}},"24":{start:{line:25,column:16},end:{line:25,column:90}},"25":{start:{line:28,column:22},end:{line:28,column:24}},"26":{start:{line:29,column:12},end:{line:32,column:13}},"27":{start:{line:30,column:37},end:{line:30,column:121}},"28":{start:{line:31,column:16},end:{line:31,column:41}},"29":{start:{line:33,column:12},end:{line:33,column:23}},"30":{start:{line:36,column:12},end:{line:36,column:57}},"31":{start:{line:37,column:12},end:{line:37,column:28}},"32":{start:{line:38,column:12},end:{line:38,column:19}},"33":{start:{line:43,column:8},end:{line:139,column:9}},"34":{start:{line:45,column:12},end:{line:45,column:39}},"35":{start:{line:46,column:12},end:{line:48,column:13}},"36":{start:{line:47,column:16},end:{line:47,column:119}},"37":{start:{line:49,column:12},end:{line:51,column:13}},"38":{start:{line:49,column:57},end:{line:49,column:89}},"39":{start:{line:50,column:16},end:{line:50,column:133}},"40":{start:{line:52,column:25},end:{line:52,column:75}},"41":{start:{line:54,column:21},end:{line:54,column:74}},"42":{start:{line:55,column:26},end:{line:55,column:30}},"43":{start:{line:56,column:12},end:{line:61,column:13}},"44":{start:{line:57,column:16},end:{line:57,column:60}},"45":{start:{line:58,column:16},end:{line:58,column:48}},"46":{start:{line:59,column:16},end:{line:59,column:32}},"47":{start:{line:60,column:16},end:{line:60,column:58}},"48":{start:{line:63,column:12},end:{line:63,column:61}},"49":{start:{line:64,column:26},end:{line:64,column:91}},"50":{start:{line:65,column:12},end:{line:67,column:13}},"51":{start:{line:66,column:16},end:{line:66,column:72}},"52":{start:{line:68,column:12},end:{line:68,column:47}},"53":{start:{line:70,column:12},end:{line:70,column:62}},"54":{start:{line:71,column:30},end:{line:71,column:89}},"55":{start:{line:72,column:12},end:{line:74,column:13}},"56":{start:{line:73,column:16},end:{line:73,column:70}},"57":{start:{line:75,column:12},end:{line:75,column:51}},"58":{start:{line:77,column:12},end:{line:77,column:151}},"59":{start:{line:78,column:12},end:{line:118,column:13}},"60":{start:{line:80,column:16},end:{line:85,column:19}},"61":{start:{line:81,column:20},end:{line:83,column:21}},"62":{start:{line:82,column:24},end:{line:82,column:51}},"63":{start:{line:84,column:20},end:{line:84,column:29}},"64":{start:{line:87,column:16},end:{line:87,column:96}},"65":{start:{line:88,column:16},end:{line:96,column:19}},"66":{start:{line:89,column:46},end:{line:91,column:22}},"67":{start:{line:90,column:24},end:{line:90,column:226}},"68":{start:{line:92,column:20},end:{line:95,column:21}},"69":{start:{line:93,column:24},end:{line:93,column:84}},"70":{start:{line:94,column:24},end:{line:94,column:68}},"71":{start:{line:98,column:32},end:{line:107,column:22}},"72":{start:{line:99,column:46},end:{line:101,column:22}},"73":{start:{line:100,column:24},end:{line:100,column:226}},"74":{start:{line:102,column:20},end:{line:105,column:21}},"75":{start:{line:103,column:24},end:{line:103,column:93}},"76":{start:{line:104,column:24},end:{line:104,column:37}},"77":{start:{line:106,column:20},end:{line:106,column:31}},"78":{start:{line:108,column:16},end:{line:108,column:93}},"79":{start:{line:110,column:16},end:{line:113,column:17}},"80":{start:{line:111,column:20},end:{line:111,column:100}},"81":{start:{line:112,column:20},end:{line:112,column:57}},"82":{start:{line:116,column:16},end:{line:116,column:84}},"83":{start:{line:117,column:16},end:{line:117,column:91}},"84":{start:{line:120,column:12},end:{line:120,column:59}},"85":{start:{line:121,column:28},end:{line:121,column:110}},"86":{start:{line:122,column:12},end:{line:122,column:59}},"87":{start:{line:124,column:12},end:{line:131,column:13}},"88":{start:{line:125,column:16},end:{line:125,column:62}},"89":{start:{line:126,column:16},end:{line:126,column:47}},"90":{start:{line:129,column:16},end:{line:129,column:68}},"91":{start:{line:130,column:16},end:{line:130,column:47}},"92":{start:{line:132,column:12},end:{line:132,column:128}},"93":{start:{line:133,column:12},end:{line:133,column:29}},"94":{start:{line:136,column:12},end:{line:136,column:78}},"95":{start:{line:137,column:12},end:{line:137,column:28}},"96":{start:{line:138,column:12},end:{line:138,column:19}},"97":{start:{line:142,column:0},end:{line:149,column:67}},"98":{start:{line:150,column:0},end:{line:158,column:63}},"99":{start:{line:159,column:0},end:{line:162,column:26}},"100":{start:{line:163,column:0},end:{line:163,column:54}}},fnMap:{"0":{name:"(anonymous_0)",decl:{start:{line:2,column:46},end:{line:2,column:47}},loc:{start:{line:2,column:87},end:{line:7,column:1}},line:2},"1":{name:"(anonymous_1)",decl:{start:{line:8,column:46},end:{line:8,column:47}},loc:{start:{line:8,column:62},end:{line:10,column:1}},line:8},"2":{name:"(anonymous_2)",decl:{start:{line:19,column:4},end:{line:19,column:5}},loc:{start:{line:19,column:18},end:{line:19,column:79}},line:19},"3":{name:"(anonymous_3)",decl:{start:{line:21,column:4},end:{line:21,column:5}},loc:{start:{line:21,column:66},end:{line:40,column:5}},line:21},"4":{name:"(anonymous_4)",decl:{start:{line:42,column:4},end:{line:42,column:5}},loc:{start:{line:42,column:65},end:{line:140,column:5}},line:42},"5":{name:"(anonymous_5)",decl:{start:{line:49,column:42},end:{line:49,column:43}},loc:{start:{line:49,column:55},end:{line:49,column:91}},line:49},"6":{name:"(anonymous_6)",decl:{start:{line:80,column:58},end:{line:80,column:59}},loc:{start:{line:80,column:71},end:{line:85,column:17}},line:80},"7":{name:"(anonymous_7)",decl:{start:{line:88,column:45},end:{line:88,column:46}},loc:{start:{line:88,column:61},end:{line:96,column:17}},line:88},"8":{name:"(anonymous_8)",decl:{start:{line:89,column:74},end:{line:89,column:75}},loc:{start:{line:89,column:105},end:{line:91,column:21}},line:89},"9":{name:"(anonymous_9)",decl:{start:{line:98,column:60},end:{line:98,column:61}},loc:{start:{line:98,column:81},end:{line:107,column:17}},line:98},"10":{name:"(anonymous_10)",decl:{start:{line:99,column:74},end:{line:99,column:75}},loc:{start:{line:99,column:105},end:{line:101,column:21}},line:99}},branchMap:{"0":{loc:{start:{line:2,column:17},end:{line:7,column:1}},type:"binary-expr",locations:[{start:{line:2,column:18},end:{line:2,column:22}},{start:{line:2,column:26},end:{line:2,column:41}},{start:{line:2,column:46},end:{line:7,column:1}}],line:2},"1":{loc:{start:{line:3,column:34},end:{line:3,column:125}},type:"cond-expr",locations:[{start:{line:3,column:42},end:{line:3,column:48}},{start:{line:3,column:51},end:{line:3,column:125}}],line:3},"2":{loc:{start:{line:3,column:51},end:{line:3,column:125}},type:"cond-expr",locations:[{start:{line:3,column:67},end:{line:3,column:118}},{start:{line:3,column:121},end:{line:3,column:125}}],line:3},"3":{loc:{start:{line:4,column:4},end:{line:5,column:150}},type:"if",locations:[{start:{line:4,column:4},end:{line:5,column:150}},{start:{line:4,column:4},end:{line:5,column:150}}],line:4},"4":{loc:{start:{line:4,column:8},end:{line:4,column:77}},type:"binary-expr",locations:[{start:{line:4,column:8},end:{line:4,column:35}},{start:{line:4,column:39},end:{line:4,column:77}}],line:4},"5":{loc:{start:{line:5,column:58},end:{line:5,column:150}},type:"if",locations:[{start:{line:5,column:58},end:{line:5,column:150}},{start:{line:5,column:58},end:{line:5,column:150}}],line:5},"6":{loc:{start:{line:5,column:85},end:{line:5,column:149}},type:"binary-expr",locations:[{start:{line:5,column:86},end:{line:5,column:143}},{start:{line:5,column:148},end:{line:5,column:149}}],line:5},"7":{loc:{start:{line:5,column:86},end:{line:5,column:143}},type:"cond-expr",locations:[{start:{line:5,column:94},end:{line:5,column:98}},{start:{line:5,column:101},end:{line:5,column:143}}],line:5},"8":{loc:{start:{line:5,column:101},end:{line:5,column:143}},type:"cond-expr",locations:[{start:{line:5,column:109},end:{line:5,column:126}},{start:{line:5,column:129},end:{line:5,column:143}}],line:5},"9":{loc:{start:{line:6,column:11},end:{line:6,column:62}},type:"binary-expr",locations:[{start:{line:6,column:11},end:{line:6,column:16}},{start:{line:6,column:20},end:{line:6,column:21}},{start:{line:6,column:25},end:{line:6,column:62}}],line:6},"10":{loc:{start:{line:8,column:17},end:{line:10,column:1}},type:"binary-expr",locations:[{start:{line:8,column:18},end:{line:8,column:22}},{start:{line:8,column:26},end:{line:8,column:41}},{start:{line:8,column:46},end:{line:10,column:1}}],line:8},"11":{loc:{start:{line:9,column:4},end:{line:9,column:109}},type:"if",locations:[{start:{line:9,column:4},end:{line:9,column:109}},{start:{line:9,column:4},end:{line:9,column:109}}],line:9},"12":{loc:{start:{line:9,column:8},end:{line:9,column:77}},type:"binary-expr",locations:[{start:{line:9,column:8},end:{line:9,column:35}},{start:{line:9,column:39},end:{line:9,column:77}}],line:9},"13":{loc:{start:{line:24,column:12},end:{line:26,column:13}},type:"if",locations:[{start:{line:24,column:12},end:{line:26,column:13}},{start:{line:24,column:12},end:{line:26,column:13}}],line:24},"14":{loc:{start:{line:46,column:12},end:{line:48,column:13}},type:"if",locations:[{start:{line:46,column:12},end:{line:48,column:13}},{start:{line:46,column:12},end:{line:48,column:13}}],line:46},"15":{loc:{start:{line:49,column:12},end:{line:51,column:13}},type:"if",locations:[{start:{line:49,column:12},end:{line:51,column:13}},{start:{line:49,column:12},end:{line:51,column:13}}],line:49},"16":{loc:{start:{line:56,column:12},end:{line:61,column:13}},type:"if",locations:[{start:{line:56,column:12},end:{line:61,column:13}},{start:{line:56,column:12},end:{line:61,column:13}}],line:56},"17":{loc:{start:{line:65,column:12},end:{line:67,column:13}},type:"if",locations:[{start:{line:65,column:12},end:{line:67,column:13}},{start:{line:65,column:12},end:{line:67,column:13}}],line:65},"18":{loc:{start:{line:72,column:12},end:{line:74,column:13}},type:"if",locations:[{start:{line:72,column:12},end:{line:74,column:13}},{start:{line:72,column:12},end:{line:74,column:13}}],line:72},"19":{loc:{start:{line:77,column:34},end:{line:77,column:124}},type:"cond-expr",locations:[{start:{line:77,column:102},end:{line:77,column:108}},{start:{line:77,column:111},end:{line:77,column:124}}],line:77},"20":{loc:{start:{line:77,column:35},end:{line:77,column:98}},type:"binary-expr",locations:[{start:{line:77,column:35},end:{line:77,column:66}},{start:{line:77,column:70},end:{line:77,column:98}}],line:77},"21":{loc:{start:{line:78,column:12},end:{line:118,column:13}},type:"if",locations:[{start:{line:78,column:12},end:{line:118,column:13}},{start:{line:78,column:12},end:{line:118,column:13}}],line:78},"22":{loc:{start:{line:78,column:16},end:{line:78,column:79}},type:"binary-expr",locations:[{start:{line:78,column:16},end:{line:78,column:47}},{start:{line:78,column:51},end:{line:78,column:79}}],line:78},"23":{loc:{start:{line:81,column:20},end:{line:83,column:21}},type:"if",locations:[{start:{line:81,column:20},end:{line:83,column:21}},{start:{line:81,column:20},end:{line:83,column:21}}],line:81},"24":{loc:{start:{line:90,column:31},end:{line:90,column:225}},type:"binary-expr",locations:[{start:{line:90,column:31},end:{line:90,column:52}},{start:{line:90,column:56},end:{line:90,column:77}},{start:{line:90,column:81},end:{line:90,column:108}},{start:{line:90,column:112},end:{line:90,column:143}},{start:{line:90,column:147},end:{line:90,column:180}},{start:{line:90,column:184},end:{line:90,column:225}}],line:90},"25":{loc:{start:{line:92,column:20},end:{line:95,column:21}},type:"if",locations:[{start:{line:92,column:20},end:{line:95,column:21}},{start:{line:92,column:20},end:{line:95,column:21}}],line:92},"26":{loc:{start:{line:100,column:31},end:{line:100,column:225}},type:"binary-expr",locations:[{start:{line:100,column:31},end:{line:100,column:52}},{start:{line:100,column:56},end:{line:100,column:77}},{start:{line:100,column:81},end:{line:100,column:108}},{start:{line:100,column:112},end:{line:100,column:143}},{start:{line:100,column:147},end:{line:100,column:180}},{start:{line:100,column:184},end:{line:100,column:225}}],line:100},"27":{loc:{start:{line:102,column:20},end:{line:105,column:21}},type:"if",locations:[{start:{line:102,column:20},end:{line:105,column:21}},{start:{line:102,column:20},end:{line:105,column:21}}],line:102},"28":{loc:{start:{line:110,column:16},end:{line:113,column:17}},type:"if",locations:[{start:{line:110,column:16},end:{line:113,column:17}},{start:{line:110,column:16},end:{line:113,column:17}}],line:110},"29":{loc:{start:{line:124,column:12},end:{line:131,column:13}},type:"if",locations:[{start:{line:124,column:12},end:{line:131,column:13}},{start:{line:124,column:12},end:{line:131,column:13}}],line:124}},s:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0,"29":0,"30":0,"31":0,"32":0,"33":0,"34":0,"35":0,"36":0,"37":0,"38":0,"39":0,"40":0,"41":0,"42":0,"43":0,"44":0,"45":0,"46":0,"47":0,"48":0,"49":0,"50":0,"51":0,"52":0,"53":0,"54":0,"55":0,"56":0,"57":0,"58":0,"59":0,"60":0,"61":0,"62":0,"63":0,"64":0,"65":0,"66":0,"67":0,"68":0,"69":0,"70":0,"71":0,"72":0,"73":0,"74":0,"75":0,"76":0,"77":0,"78":0,"79":0,"80":0,"81":0,"82":0,"83":0,"84":0,"85":0,"86":0,"87":0,"88":0,"89":0,"90":0,"91":0,"92":0,"93":0,"94":0,"95":0,"96":0,"97":0,"98":0,"99":0,"100":0},f:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0},b:{"0":[0,0,0],"1":[0,0],"2":[0,0],"3":[0,0],"4":[0,0],"5":[0,0],"6":[0,0],"7":[0,0],"8":[0,0],"9":[0,0,0],"10":[0,0,0],"11":[0,0],"12":[0,0],"13":[0,0],"14":[0,0],"15":[0,0],"16":[0,0],"17":[0,0],"18":[0,0],"19":[0,0],"20":[0,0],"21":[0,0],"22":[0,0],"23":[0,0],"24":[0,0,0,0,0,0],"25":[0,0],"26":[0,0,0,0,0,0],"27":[0,0],"28":[0,0],"29":[0,0]},_coverageSchema:"43e27e138ebf9cfc5966b082cf9a028302ed4184",hash:"e0df90663e2cf4291ead61a396a3d141b97cd9b6"};var coverage=global[gcv]||(global[gcv]={});if(coverage[path]&&coverage[path].hash===hash){return coverage[path];}return coverage[path]=coverageData;}();var __decorate=(cov_2evwnnbx36.s[0]++,(cov_2evwnnbx36.b[0][0]++,this)&&(cov_2evwnnbx36.b[0][1]++,this.__decorate)||(cov_2evwnnbx36.b[0][2]++,function(decorators,target,key,desc){cov_2evwnnbx36.f[0]++;var c=(cov_2evwnnbx36.s[1]++,arguments.length),r=(cov_2evwnnbx36.s[2]++,c<3?(cov_2evwnnbx36.b[1][0]++,target):(cov_2evwnnbx36.b[1][1]++,desc===null?(cov_2evwnnbx36.b[2][0]++,desc=Object.getOwnPropertyDescriptor(target,key)):(cov_2evwnnbx36.b[2][1]++,desc))),d;cov_2evwnnbx36.s[3]++;if((cov_2evwnnbx36.b[4][0]++,typeof Reflect==="object")&&(cov_2evwnnbx36.b[4][1]++,typeof Reflect.decorate==="function")){cov_2evwnnbx36.b[3][0]++;cov_2evwnnbx36.s[4]++;r=Reflect.decorate(decorators,target,key,desc);}else{cov_2evwnnbx36.b[3][1]++;cov_2evwnnbx36.s[5]++;for(var i=(cov_2evwnnbx36.s[6]++,decorators.length-1);i>=0;i--){cov_2evwnnbx36.s[7]++;if(d=decorators[i]){cov_2evwnnbx36.b[5][0]++;cov_2evwnnbx36.s[8]++;r=(cov_2evwnnbx36.b[6][0]++,c<3?(cov_2evwnnbx36.b[7][0]++,d(r)):(cov_2evwnnbx36.b[7][1]++,c>3?(cov_2evwnnbx36.b[8][0]++,d(target,key,r)):(cov_2evwnnbx36.b[8][1]++,d(target,key))))||(cov_2evwnnbx36.b[6][1]++,r);}else{cov_2evwnnbx36.b[5][1]++;}}}cov_2evwnnbx36.s[9]++;return(cov_2evwnnbx36.b[9][0]++,c>3)&&(cov_2evwnnbx36.b[9][1]++,r)&&(cov_2evwnnbx36.b[9][2]++,Object.defineProperty(target,key,r)),r;}));var __metadata=(cov_2evwnnbx36.s[10]++,(cov_2evwnnbx36.b[10][0]++,this)&&(cov_2evwnnbx36.b[10][1]++,this.__metadata)||(cov_2evwnnbx36.b[10][2]++,function(k,v){cov_2evwnnbx36.f[1]++;cov_2evwnnbx36.s[11]++;if((cov_2evwnnbx36.b[12][0]++,typeof Reflect==="object")&&(cov_2evwnnbx36.b[12][1]++,typeof Reflect.metadata==="function")){cov_2evwnnbx36.b[11][0]++;cov_2evwnnbx36.s[12]++;return Reflect.metadata(k,v);}else{cov_2evwnnbx36.b[11][1]++;}}));cov_2evwnnbx36.s[13]++;Object.defineProperty(exports,"__esModule",{value:true});const fabric_contract_api_1=(cov_2evwnnbx36.s[14]++,require("fabric-contract-api"));const models_1=(cov_2evwnnbx36.s[15]++,require("../models"));const repositories_1=(cov_2evwnnbx36.s[16]++,require("../repositories"));const processing_engine_1=(cov_2evwnnbx36.s[17]++,require("../processing-engine"));const Logger=(cov_2evwnnbx36.s[18]++,require('../logger'));const logger=(cov_2evwnnbx36.s[19]++,Logger.getLogger('./contracts/vendor-shipped.contract.ts'));cov_2evwnnbx36.s[20]++;let VendorShippedContract=class VendorShippedContract extends fabric_contract_api_1.Contract{constructor(){cov_2evwnnbx36.f[2]++;cov_2evwnnbx36.s[21]++;super("com.homedepot.procurement.VendorShippedContract");}// Used to bulk merge several records of new VendorShipped data with existing VendorShipped data
async bulkSaveVendorShipped(ctx,newListOfVendorShippedLists){cov_2evwnnbx36.f[3]++;cov_2evwnnbx36.s[22]++;try{cov_2evwnnbx36.s[23]++;// Sanity-checks: list.length > 0
if(newListOfVendorShippedLists.length===0){cov_2evwnnbx36.b[13][0]++;cov_2evwnnbx36.s[24]++;throw new Error(`bulkSaveVendorShipped was called with 0 VendorShippeds`);}else{cov_2evwnnbx36.b[13][1]++;}// Add each set of PO items to the blockchain, one PONumber at a time
let aps=(cov_2evwnnbx36.s[25]++,[]);cov_2evwnnbx36.s[26]++;for(let currentItemsList of newListOfVendorShippedLists){let currentSavedAP=(cov_2evwnnbx36.s[27]++,await this.saveVendorShipped(ctx,currentItemsList.PONumber,currentItemsList.Items));cov_2evwnnbx36.s[28]++;aps.push(currentSavedAP);}cov_2evwnnbx36.s[29]++;return aps;}catch(e){cov_2evwnnbx36.s[30]++;logger.error(`bulkSaveVendorShipped failed`);cov_2evwnnbx36.s[31]++;logger.error(e);cov_2evwnnbx36.s[32]++;return;}}// Used to merge new VendorShipped data with existing VendorShipped data
async saveVendorShipped(ctx,poNumber,newVendorShippedList){cov_2evwnnbx36.f[4]++;cov_2evwnnbx36.s[33]++;try{cov_2evwnnbx36.s[34]++;// Sanity-checks: vslist.length > 0, all items in vslist have PONumber=poNumber
poNumber=poNumber.trim();cov_2evwnnbx36.s[35]++;if(newVendorShippedList.length===0){cov_2evwnnbx36.b[14][0]++;cov_2evwnnbx36.s[36]++;throw new Error(`saveVendorShipped was called with 0 VendorShipped items, for PONumber '${poNumber}'`);}else{cov_2evwnnbx36.b[14][1]++;}cov_2evwnnbx36.s[37]++;if(newVendorShippedList.some((v,i,l)=>{cov_2evwnnbx36.f[5]++;cov_2evwnnbx36.s[38]++;return v.PONumber!=poNumber;})){cov_2evwnnbx36.b[15][0]++;cov_2evwnnbx36.s[39]++;throw new Error(`saveVendorShipped was called with some VendorShipped items that do not have PONUmber '${poNumber}`);}else{cov_2evwnnbx36.b[15][1]++;}let apRepo=(cov_2evwnnbx36.s[40]++,new repositories_1.AssetProcurementRepository(ctx));// Retrieve or create the AssetProcurement record
let ap=(cov_2evwnnbx36.s[41]++,new models_1.AssetProcurement({PONumber:poNumber}));let apIsNew=(cov_2evwnnbx36.s[42]++,true);cov_2evwnnbx36.s[43]++;if((await apRepo.exists(poNumber))==true){cov_2evwnnbx36.b[16][0]++;cov_2evwnnbx36.s[44]++;logger.debug(`PONumber ${poNumber} exists`);cov_2evwnnbx36.s[45]++;ap=await apRepo.get(poNumber);cov_2evwnnbx36.s[46]++;apIsNew=false;cov_2evwnnbx36.s[47]++;logger.debug('Retreived AP from storage');}else{cov_2evwnnbx36.b[16][1]++;}// Get the list of UnitOfMeasure data
cov_2evwnnbx36.s[48]++;logger.debug('Retrieving UOM data from storage');let uomList=(cov_2evwnnbx36.s[49]++,await new repositories_1.UnitOfMeasureListRepository(ctx).get());cov_2evwnnbx36.s[50]++;if(uomList===undefined){cov_2evwnnbx36.b[17][0]++;cov_2evwnnbx36.s[51]++;uomList=new models_1.UnitOfMeasureList({Items:[]});}else{cov_2evwnnbx36.b[17][1]++;}cov_2evwnnbx36.s[52]++;logger.debug(uomList.Items.length);// Retrieve the current ADR Rule data
cov_2evwnnbx36.s[53]++;logger.debug('Retrieving ADR Rules from storage');let adrRuleList=(cov_2evwnnbx36.s[54]++,await new repositories_1.ADRRuleListRepository(ctx).get());cov_2evwnnbx36.s[55]++;if(adrRuleList===undefined){cov_2evwnnbx36.b[18][0]++;cov_2evwnnbx36.s[56]++;adrRuleList=new models_1.ADRRuleList({Items:[]});}else{cov_2evwnnbx36.b[18][1]++;}cov_2evwnnbx36.s[57]++;logger.debug(adrRuleList.Items.length);// Merge the existing VendorShipped data with the new data
cov_2evwnnbx36.s[58]++;logger.debug('We '+((cov_2evwnnbx36.b[20][0]++,ap.VendorShippeds!==undefined)&&(cov_2evwnnbx36.b[20][1]++,ap.VendorShippeds.length>0)?(cov_2evwnnbx36.b[19][0]++,'have'):(cov_2evwnnbx36.b[19][1]++,'do not have'))+' VS data for the AP');cov_2evwnnbx36.s[59]++;if((cov_2evwnnbx36.b[22][0]++,ap.VendorShippeds!==undefined)&&(cov_2evwnnbx36.b[22][1]++,ap.VendorShippeds.length>0)){cov_2evwnnbx36.b[21][0]++;cov_2evwnnbx36.s[60]++;// HACK : We need to repair any existing UCC128's that are missing the SSCC application identifier ('00' prefix).....this should be removed after all entries in the blockchain are repaired
ap.VendorShippeds=ap.VendorShippeds.map((v,i,l)=>{cov_2evwnnbx36.f[6]++;cov_2evwnnbx36.s[61]++;if(v.UCC128.length==18){cov_2evwnnbx36.b[23][0]++;cov_2evwnnbx36.s[62]++;v.UCC128='00'+v.UCC128;}else{cov_2evwnnbx36.b[23][1]++;}cov_2evwnnbx36.s[63]++;return v;});// Merge any records that match on key identifier fields
cov_2evwnnbx36.s[64]++;logger.debug(`Starting with ${newVendorShippedList.length} new VendorShippeds`);cov_2evwnnbx36.s[65]++;newVendorShippedList.forEach((vc,ic,lc)=>{cov_2evwnnbx36.f[7]++;let existingRecordIndex=(cov_2evwnnbx36.s[66]++,ap.VendorShippeds.findIndex((innerVC,innerIC,innerLC)=>{cov_2evwnnbx36.f[8]++;cov_2evwnnbx36.s[67]++;return(cov_2evwnnbx36.b[24][0]++,vc.RDC==innerVC.RDC)&&(cov_2evwnnbx36.b[24][1]++,vc.SKU==innerVC.SKU)&&(cov_2evwnnbx36.b[24][2]++,vc.UCC128==innerVC.UCC128)&&(cov_2evwnnbx36.b[24][3]++,vc.PONumber==innerVC.PONumber)&&(cov_2evwnnbx36.b[24][4]++,vc.ASNNumber==innerVC.ASNNumber)&&(cov_2evwnnbx36.b[24][5]++,vc.ASNShipmentID==innerVC.ASNShipmentID);}));cov_2evwnnbx36.s[68]++;if(existingRecordIndex>-1){cov_2evwnnbx36.b[25][0]++;cov_2evwnnbx36.s[69]++;logger.debug('Found a new VS that matched an existing one');cov_2evwnnbx36.s[70]++;ap.VendorShippeds[existingRecordIndex]=vc;}else{cov_2evwnnbx36.b[25][1]++;}});// Deterimine all records that are new and do not match any existing records
let uniqueVSs=(cov_2evwnnbx36.s[71]++,newVendorShippedList.reduce((pac,vc,ic,lc)=>{cov_2evwnnbx36.f[9]++;let existingRecordIndex=(cov_2evwnnbx36.s[72]++,ap.VendorShippeds.findIndex((innerVC,innerIC,innerLC)=>{cov_2evwnnbx36.f[10]++;cov_2evwnnbx36.s[73]++;return(cov_2evwnnbx36.b[26][0]++,vc.RDC==innerVC.RDC)&&(cov_2evwnnbx36.b[26][1]++,vc.SKU==innerVC.SKU)&&(cov_2evwnnbx36.b[26][2]++,vc.UCC128==innerVC.UCC128)&&(cov_2evwnnbx36.b[26][3]++,vc.PONumber==innerVC.PONumber)&&(cov_2evwnnbx36.b[26][4]++,vc.ASNNumber==innerVC.ASNNumber)&&(cov_2evwnnbx36.b[26][5]++,vc.ASNShipmentID==innerVC.ASNShipmentID);}));cov_2evwnnbx36.s[74]++;if(existingRecordIndex==-1){cov_2evwnnbx36.b[27][0]++;cov_2evwnnbx36.s[75]++;logger.debug('Found a new VS that does not match the existing ones');cov_2evwnnbx36.s[76]++;pac.push(vc);}else{cov_2evwnnbx36.b[27][1]++;}cov_2evwnnbx36.s[77]++;return pac;},[]));cov_2evwnnbx36.s[78]++;logger.debug(`Ended up with ${uniqueVSs.length} totally new VendorShippeds`);// If we found some new records to add, Append new records to the existing ones
cov_2evwnnbx36.s[79]++;if(uniqueVSs.length>0){cov_2evwnnbx36.b[28][0]++;cov_2evwnnbx36.s[80]++;logger.debug('Adding the final list of unique VSs to the existing list of VSs');cov_2evwnnbx36.s[81]++;ap.VendorShippeds.push(...uniqueVSs);}else{cov_2evwnnbx36.b[28][1]++;}}else{cov_2evwnnbx36.b[21][1]++;cov_2evwnnbx36.s[82]++;logger.debug('Adding all new VSs since there are no existing VSs.');cov_2evwnnbx36.s[83]++;ap.setStageDetails(models_1.StageType.VendorShipped,newVendorShippedList);}// Run this through the processing engine (FSM)
cov_2evwnnbx36.s[84]++;logger.debug('Starting the processing engine');let updatedAP=(cov_2evwnnbx36.s[85]++,processing_engine_1.ProcessingEngine.startProcessing(ap,{uomList,adrRuleList}));cov_2evwnnbx36.s[86]++;logger.debug('Finished the processing engine');// Save the AssetProcurement record
cov_2evwnnbx36.s[87]++;if(apIsNew){cov_2evwnnbx36.b[29][0]++;cov_2evwnnbx36.s[88]++;logger.debug('Attempting to create a new AP');cov_2evwnnbx36.s[89]++;await apRepo.create(updatedAP);}else{cov_2evwnnbx36.b[29][1]++;cov_2evwnnbx36.s[90]++;logger.debug('Attempting to update an existing AP');cov_2evwnnbx36.s[91]++;await apRepo.update(updatedAP);}cov_2evwnnbx36.s[92]++;logger.debug(`saveVendorShipped saved ${newVendorShippedList.length} VendorShipped items for PONumber ${poNumber}`);cov_2evwnnbx36.s[93]++;return updatedAP;}catch(e){cov_2evwnnbx36.s[94]++;logger.error(`saveVendorShipped failed for PONumber ${poNumber}`);cov_2evwnnbx36.s[95]++;logger.error(e);cov_2evwnnbx36.s[96]++;return;}}};cov_2evwnnbx36.s[97]++;__decorate([fabric_contract_api_1.Transaction(),fabric_contract_api_1.Param("newListOfVendorShippedLists","VendorShippedList[]"),fabric_contract_api_1.Returns('AssetProcurement[]'),__metadata("design:type",Function),__metadata("design:paramtypes",[fabric_contract_api_1.Context,Array]),__metadata("design:returntype",Promise)],VendorShippedContract.prototype,"bulkSaveVendorShipped",null);cov_2evwnnbx36.s[98]++;__decorate([fabric_contract_api_1.Transaction(),fabric_contract_api_1.Param("poNumber","string"),fabric_contract_api_1.Param("newVendorShippedList","VendorShipped[]"),fabric_contract_api_1.Returns('AssetProcurement'),__metadata("design:type",Function),__metadata("design:paramtypes",[fabric_contract_api_1.Context,String,Array]),__metadata("design:returntype",Promise)],VendorShippedContract.prototype,"saveVendorShipped",null);cov_2evwnnbx36.s[99]++;VendorShippedContract=__decorate([fabric_contract_api_1.Info({title:'VendorShippedContract',description:'Contract for managing the list of VendorShippeds, and their related discrepancies'}),__metadata("design:paramtypes",[])],VendorShippedContract);cov_2evwnnbx36.s[100]++;exports.VendorShippedContract=VendorShippedContract;//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiQzpcXFVzZXJzXFxQUkFLQVNIU0VMVkFSQUpcXEJsb2NrY2hhaW5cXEhvbWUgRGVwb3RcXERldmVsb3BtZW50XFxjaGFpbmNvZGVfMDkwMVxcc3JjXFxjb250cmFjdHNcXHZlbmRvci1zaGlwcGVkLmNvbnRyYWN0LnRzIiwic291cmNlcyI6WyJDOlxcVXNlcnNcXFBSQUtBU0hTRUxWQVJBSlxcQmxvY2tjaGFpblxcSG9tZSBEZXBvdFxcRGV2ZWxvcG1lbnRcXGNoYWluY29kZV8wOTAxXFxzcmNcXGNvbnRyYWN0c1xcdmVuZG9yLXNoaXBwZWQuY29udHJhY3QudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7QUFBQSw2REFBMkY7QUFDM0Ysc0NBQWtKO0FBQ2xKLGtEQUFpSDtBQUNqSCw0REFBd0Q7QUFFeEQsTUFBTSxNQUFNLEdBQUcsT0FBTyxDQUFDLFdBQVcsQ0FBQyxDQUFDO0FBQ3BDLE1BQU0sTUFBTSxHQUFHLE1BQU0sQ0FBQyxTQUFTLENBQUMsd0NBQXdDLENBQUMsQ0FBQztBQUkxRSxJQUFhLHFCQUFxQixHQUFsQyxNQUFhLHFCQUFzQixTQUFRLDhCQUFRO0lBRy9DLGdCQUFnQixLQUFLLENBQUMsaURBQWlELENBQUMsQ0FBQyxDQUFDLENBQUM7SUFHM0UsZ0dBQWdHO0lBSXpGLEtBQUssQ0FBQyxxQkFBcUIsQ0FBQyxHQUFZLEVBQUUsMkJBQWdEO1FBQzdGLElBQUk7WUFDQSxpQ0FBaUM7WUFDakMsSUFBSSwyQkFBMkIsQ0FBQyxNQUFNLEtBQUssQ0FBQyxFQUFDO2dCQUN6QyxNQUFNLElBQUksS0FBSyxDQUFDLHdEQUF3RCxDQUFDLENBQUM7YUFDN0U7WUFFRCxxRUFBcUU7WUFDckUsSUFBSSxHQUFHLEdBQXdCLEVBQUUsQ0FBQztZQUNsQyxLQUFLLElBQUksZ0JBQWdCLElBQUksMkJBQTJCLEVBQUU7Z0JBQ3RELElBQUksY0FBYyxHQUFzQixNQUFNLElBQUksQ0FBQyxpQkFBaUIsQ0FBQyxHQUFHLEVBQUUsZ0JBQWdCLENBQUMs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S0FBSyxDQUFDLHlDQUF5QyxRQUFRLEVBQUUsQ0FBQyxDQUFDO1lBQ2xFLE1BQU0sQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUM7WUFDaEIsT0FBTztTQUNWO0lBQ0wsQ0FBQztDQUVKLENBQUE7QUFwSUc7SUFIQyxpQ0FBVyxFQUFFO0lBQ2IsMkJBQUssQ0FBQyw2QkFBNkIsRUFBRSxxQkFBcUIsQ0FBQztJQUMzRCw2QkFBTyxDQUFDLG9CQUFvQixDQUFDOztxQ0FDVSw2QkFBTzs7a0VBb0I5QztBQVNEO0lBSkMsaUNBQVcsRUFBRTtJQUNiLDJCQUFLLENBQUMsVUFBVSxFQUFFLFFBQVEsQ0FBQztJQUMzQiwyQkFBSyxDQUFDLHNCQUFzQixFQUFFLGlCQUFpQixDQUFDO0lBQ2hELDZCQUFPLENBQUMsa0JBQWtCLENBQUM7O3FDQUNRLDZCQUFPOzs4REFxRzFDO0FBNUlRLHFCQUFxQjtJQURqQywwQkFBSSxDQUFDLEVBQUUsS0FBSyxFQUFFLHVCQUF1QixFQUFFLFdBQVcsRUFBRSxtRkFBbUYsRUFBRSxDQUFDOztHQUM5SCxxQkFBcUIsQ0E4SWpDO0FBOUlZLHNEQUFxQiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IENvbnRleHQsIENvbnRyYWN0LCBJbmZvLCBSZXR1cm5zLCBUcmFuc2FjdGlvbiwgUGFyYW0gfSBmcm9tICdmYWJyaWMtY29udHJhY3QtYXBpJztcclxuaW1wb3J0IHsgVmVuZG9yU2hpcHBlZCwgQXNzZXRQcm9jdXJlbWVudCwgU3RhZ2VUeXBlLCBVbml0T2ZNZWFzdXJlLCBVbml0T2ZNZWFzdXJlTGlzdCwgQURSUnVsZSwgQURSUnVsZUxpc3QsIFZlbmRvclNoaXBwZWRMaXN0IH0gZnJvbSBcIi4uL21vZGVsc1wiO1xyXG5pbXBvcnQgeyBBc3NldFByb2N1cmVtZW50UmVwb3NpdG9yeSwgVW5pdE9mTWVhc3VyZUxpc3RSZXBvc2l0b3J5LCBBRFJSdWxlTGlzdFJlcG9zaXRvcnkgfSBmcm9tICcuLi9yZXBvc2l0b3JpZXMnO1xyXG5pbXBvcnQgeyBQcm9jZXNzaW5nRW5naW5lIH0gZnJvbSAnLi4vcHJvY2Vzc2luZy1lbmdpbmUnO1xyXG5cclxuY29uc3QgTG9nZ2VyID0gcmVxdWlyZSgnLi4vbG9nZ2VyJyk7XHJcbmNvbnN0IGxvZ2dlciA9IExvZ2dlci5nZXRMb2dnZXIoJy4vY29udHJhY3RzL3ZlbmRvci1zaGlwcGVkLmNvbnRyYWN0LnRzJyk7XHJcblxyXG5cclxuQEluZm8oeyB0aXRsZTogJ1ZlbmRvclNoaXBwZWRDb250cmFjdCcsIGRlc2NyaXB0aW9uOiAnQ29udHJhY3QgZm9yIG1hbmFnaW5nIHRoZSBsaXN0IG9mIFZlbmRvclNoaXBwZWRzLCBhbmQgdGhlaXIgcmVsYXRlZCBkaXNjcmVwYW5jaWVzJyB9KVxyXG5leHBvcnQgY2xhc3MgVmVuZG9yU2hpcHBlZENvbnRyYWN0IGV4dGVuZHMgQ29udHJhY3Qge1xyXG5cclxuXHJcbiAgICBjb25zdHJ1Y3RvcigpIHsgc3VwZXIoXCJjb20uaG9tZWRlcG90LnByb2N1cmVtZW50LlZlbmRvclNoaXBwZWRDb250cmFjdFwiKTsgfVxyXG5cclxuXHJcbiAgICAvLyBVc2VkIHRvIGJ1bGsgbWVyZ2Ugc2V2ZXJhbCByZWNvcmRzIG9mIG5ldyBWZW5kb3JTaGlwcGVkIGRhdGEgd2l0aCBleGlzdGluZyBWZW5kb3JTaGlwcGVkIGRhdGFcclxuICAgIEBUcmFuc2FjdGlvbigpXHJcbiAgICBAUGFyYW0oXCJuZXdMaXN0T2ZWZW5kb3JTaGlwcGVkTGlzdHNcIiwgXCJWZW5kb3JTaGlwcGVkTGlzdFtdXCIpXHJcbiAgICBAUmV0dXJucygnQXNzZXRQcm9jdXJlbWVudFtdJykgICAgXHJcbiAgICBwdWJsaWMgYXN5bmMgYnVsa1NhdmVWZW5kb3JTaGlwcGVkKGN0eDogQ29udGV4dCwgbmV3TGlzdE9mVmVuZG9yU2hpcHBlZExpc3RzOiBWZW5kb3JTaGlwcGVkTGlzdFtdKTogUHJvbWlzZTxBc3NldFByb2N1cmVtZW50W10+IHsgIFxyXG4gICAgICAgIHRyeSB7XHJcbiAgICAgICAgICAgIC8vIFNhbml0eS1jaGVja3M6IGxpc3QubGVuZ3RoID4gMFxyXG4gICAgICAgICAgICBpZiAobmV3TGlzdE9mVmVuZG9yU2hpcHBlZExpc3RzLmxlbmd0aCA9PT0gMCl7IFxyXG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBidWxrU2F2ZVZlbmRvclNoaXBwZWQgd2FzIGNhbGxlZCB3aXRoIDAgVmVuZG9yU2hpcHBlZHNgKTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgLy8gQWRkIGVhY2ggc2V0IG9mIFBPIGl0ZW1zIHRvIHRoZSBibG9ja2NoYWluLCBvbmUgUE9OdW1iZXIgYXQgYSB0aW1lXHJcbiAgICAgICAgICAgIGxldCBhcHMgOiBBc3NldFByb2N1cmVtZW50W10gPSBbXTtcclxuICAgICAgICAgICAgZm9yIChsZXQgY3VycmVudEl0ZW1zTGlzdCBvZiBuZXdMaXN0T2ZWZW5kb3JTaGlwcGVkTGlzdHMpIHtcclxuICAgICAgICAgICAgICAgIGxldCBjdXJyZW50U2F2ZWRBUCA6IEFzc2V0UHJvY3VyZW1lbnQgPSBhd2FpdCB0aGlzLnNhdmVWZW5kb3JTaGlwcGVkKGN0eCwgY3VycmVudEl0ZW1zTGlzdC5QT051bWJlciwgY3VycmVudEl0ZW1zTGlzdC5JdGVtcyk7XHJcbiAgICAgICAgICAgICAgICBhcHMucHVzaChjdXJyZW50U2F2ZWRBUCk7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIHJldHVybiBhcHM7XHJcbiAgICAgICAgfSBjYXRjaCAoZSkge1xyXG4gICAgICAgICAgICBsb2dnZXIuZXJyb3IoYGJ1bGtTYXZlVmVuZG9yU2hpcHBlZCBmYWlsZWRgKTtcclxuICAgICAgICAgICAgbG9nZ2VyLmVycm9yKGUpO1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuXHJcblxyXG4gICAgLy8gVXNlZCB0byBtZXJnZSBuZXcgVmVuZG9yU2hpcHBlZCBkYXRhIHdpdGggZXhpc3RpbmcgVmVuZG9yU2hpcHBlZCBkYXRhXHJcbiAgICBAVHJhbnNhY3Rpb24oKVxyXG4gICAgQFBhcmFtKFwicG9OdW1iZXJcIiwgXCJzdHJpbmdcIilcclxuICAgIEBQYXJhbShcIm5ld1ZlbmRvclNoaXBwZWRMaXN0XCIsIFwiVmVuZG9yU2hpcHBlZFtdXCIpXHJcbiAgICBAUmV0dXJucygnQXNzZXRQcm9jdXJlbWVudCcpICAgIFxyXG4gICAgcHVibGljIGFzeW5jIHNhdmVWZW5kb3JTaGlwcGVkKGN0eDogQ29udGV4dCwgcG9OdW1iZXI6IHN0cmluZywgbmV3VmVuZG9yU2hpcHBlZExpc3Q6IFZlbmRvclNoaXBwZWRbXSk6IFByb21pc2U8QXNzZXRQcm9jdXJlbWVudD4geyAgXHJcbiAgICAgICAgdHJ5IHtcclxuICAgICAgICAgICAgLy8gU2FuaXR5LWNoZWNrczogdnNsaXN0Lmxlbmd0aCA+IDAsIGFsbCBpdGVtcyBpbiB2c2xpc3QgaGF2ZSBQT051bWJlcj1wb051bWJlclxyXG4gICAgICAgICAgICBwb051bWJlciA9IHBvTnVtYmVyLnRyaW0oKTtcclxuICAgICAgICAgICAgaWYgKG5ld1ZlbmRvclNoaXBwZWRMaXN0Lmxlbmd0aCA9PT0gMCl7IFxyXG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBzYXZlVmVuZG9yU2hpcHBlZCB3YXMgY2FsbGVkIHdpdGggMCBWZW5kb3JTaGlwcGVkIGl0ZW1zLCBmb3IgUE9OdW1iZXIgJyR7cG9OdW1iZXJ9J2ApO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmIChuZXdWZW5kb3JTaGlwcGVkTGlzdC5zb21lKCh2LGksbCk9PnsgcmV0dXJuICh2LlBPTnVtYmVyICE9IHBvTnVtYmVyKTsgfSkpIHtcclxuICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihgc2F2ZVZlbmRvclNoaXBwZWQgd2FzIGNhbGxlZCB3aXRoIHNvbWUgVmVuZG9yU2hpcHBlZCBpdGVtcyB0aGF0IGRvIG5vdCBoYXZlIFBPTlVtYmVyICcke3BvTnVtYmVyfWApO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBsZXQgYXBSZXBvIDogQXNzZXRQcm9jdXJlbWVudFJlcG9zaXRvcnkgPSBuZXcgQXNzZXRQcm9jdXJlbWVudFJlcG9zaXRvcnkoY3R4KTtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIC8vIFJldHJpZXZlIG9yIGNyZWF0ZSB0aGUgQXNzZXRQcm9jdXJlbWVudCByZWNvcmRcclxuICAgICAgICAgICAgbGV0IGFwIDogQXNzZXRQcm9jdXJlbWVudCA9IG5ldyBBc3NldFByb2N1cmVtZW50KHsgUE9OdW1iZXI6IHBvTnVtYmVyIH0pO1xyXG4gICAgICAgICAgICBsZXQgYXBJc05ldyA6IGJvb2xlYW4gPSB0cnVlO1xyXG4gICAgICAgICAgICBpZiAoYXdhaXQgYXBSZXBvLmV4aXN0cyhwb051bWJlcikgPT0gdHJ1ZSkge1xyXG4gICAgICAgICAgICAgICAgbG9nZ2VyLmRlYnVnKGBQT051bWJlciAke3BvTnVtYmVyfSBleGlzdHNgKTtcclxuICAgICAgICAgICAgICAgIGFwID0gYXdhaXQgYXBSZXBvLmdldChwb051bWJlcik7XHJcbiAgICAgICAgICAgICAgICBhcElzTmV3ID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICBsb2dnZXIuZGVidWcoJ1JldHJlaXZlZCBBUCBmcm9tIHN0b3JhZ2UnKTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgLy8gR2V0IHRoZSBsaXN0IG9mIFVuaXRPZk1lYXN1cmUgZGF0YVxyXG4gICAgICAgICAgICBsb2dnZXIuZGVidWcoJ1JldHJpZXZpbmcgVU9NIGRhdGEgZnJvbSBzdG9yYWdlJyk7XHJcbiAgICAgICAgICAgIGxldCB1b21MaXN0IDogVW5pdE9mTWVhc3VyZUxpc3QgfCB1bmRlZmluZWQgPSBhd2FpdCAobmV3IFVuaXRPZk1lYXN1cmVMaXN0UmVwb3NpdG9yeShjdHgpKS5nZXQoKTtcclxuICAgICAgICAgICAgaWYgKHVvbUxpc3QgPT09IHVuZGVmaW5lZCl7IHVvbUxpc3QgPSBuZXcgVW5pdE9mTWVhc3VyZUxpc3QoeyBJdGVtczogW10gfSk7IH1cclxuICAgICAgICAgICAgbG9nZ2VyLmRlYnVnKHVvbUxpc3QuSXRlbXMubGVuZ3RoKTtcclxuICAgICAgICBcclxuICAgICAgICAgICAgLy8gUmV0cmlldmUgdGhlIGN1cnJlbnQgQURSIFJ1bGUgZGF0YVxyXG4gICAgICAgICAgICBsb2dnZXIuZGVidWcoJ1JldHJpZXZpbmcgQURSIFJ1bGVzIGZyb20gc3RvcmFnZScpO1xyXG4gICAgICAgICAgICBsZXQgYWRyUnVsZUxpc3QgOiBBRFJSdWxlTGlzdCB8IHVuZGVmaW5lZCA9IGF3YWl0IChuZXcgQURSUnVsZUxpc3RSZXBvc2l0b3J5KGN0eCkpLmdldCgpO1xyXG4gICAgICAgICAgICBpZiAoYWRyUnVsZUxpc3QgPT09IHVuZGVmaW5lZCl7IGFkclJ1bGVMaXN0ID0gbmV3IEFEUlJ1bGVMaXN0KHsgSXRlbXM6IFtdIH0pOyB9XHJcbiAgICAgICAgICAgIGxvZ2dlci5kZWJ1ZyhhZHJSdWxlTGlzdC5JdGVtcy5sZW5ndGgpO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgLy8gTWVyZ2UgdGhlIGV4aXN0aW5nIFZlbmRvclNoaXBwZWQgZGF0YSB3aXRoIHRoZSBuZXcgZGF0YVxyXG4gICAgICAgICAgICBsb2dnZXIuZGVidWcoJ1dlICcgKyAoKGFwLlZlbmRvclNoaXBwZWRzICE9PSB1bmRlZmluZWQgJiYgYXAuVmVuZG9yU2hpcHBlZHMubGVuZ3RoID4gMCkgPyAnaGF2ZScgOiAnZG8gbm90IGhhdmUnKSArICcgVlMgZGF0YSBmb3IgdGhlIEFQJyk7XHJcbiAgICAgICAgICAgIGlmIChhcC5WZW5kb3JTaGlwcGVkcyAhPT0gdW5kZWZpbmVkICYmIGFwLlZlbmRvclNoaXBwZWRzLmxlbmd0aCA+IDApIHtcclxuXHJcbiAgICAgICAgICAgICAgICAvLyBIQUNLIDogV2UgbmVlZCB0byByZXBhaXIgYW55IGV4aXN0aW5nIFVDQzEyOCdzIHRoYXQgYXJlIG1pc3NpbmcgdGhlIFNTQ0MgYXBwbGljYXRpb24gaWRlbnRpZmllciAoJzAwJyBwcmVmaXgpLi4uLi50aGlzIHNob3VsZCBiZSByZW1vdmVkIGFmdGVyIGFsbCBlbnRyaWVzIGluIHRoZSBibG9ja2NoYWluIGFyZSByZXBhaXJlZFxyXG4gICAgICAgICAgICAgICAgYXAuVmVuZG9yU2hpcHBlZHMgPSBhcC5WZW5kb3JTaGlwcGVkcy5tYXAoKHYsaSxsKT0+e1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICh2LlVDQzEyOC5sZW5ndGggPT0gMTgpIHsgdi5VQ0MxMjggPSAnMDAnICsgdi5VQ0MxMjg7IH1cclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdjtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgICAgIC8vIE1lcmdlIGFueSByZWNvcmRzIHRoYXQgbWF0Y2ggb24ga2V5IGlkZW50aWZpZXIgZmllbGRzXHJcbiAgICAgICAgICAgICAgICBsb2dnZXIuZGVidWcoYFN0YXJ0aW5nIHdpdGggJHtuZXdWZW5kb3JTaGlwcGVkTGlzdC5sZW5ndGh9IG5ldyBWZW5kb3JTaGlwcGVkc2ApO1xyXG4gICAgICAgICAgICAgICAgbmV3VmVuZG9yU2hpcHBlZExpc3QuZm9yRWFjaCgodmMsaWMsbGMpPT57XHJcbiAgICAgICAgICAgICAgICAgICAgbGV0IGV4aXN0aW5nUmVjb3JkSW5kZXggPSBhcC5WZW5kb3JTaGlwcGVkcyEuZmluZEluZGV4KChpbm5lclZDLGlubmVySUMsaW5uZXJMQyk9PntcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHZjLlJEQz09aW5uZXJWQy5SREMgJiYgdmMuU0tVID09IGlubmVyVkMuU0tVICYmIHZjLlVDQzEyOCA9PSBpbm5lclZDLlVDQzEyOCAmJiB2Yy5QT051bWJlcj09aW5uZXJWQy5QT051bWJlciAmJiB2Yy5BU05OdW1iZXI9PWlubmVyVkMuQVNOTnVtYmVyICYmIHZjLkFTTlNoaXBtZW50SUQ9PWlubmVyVkMuQVNOU2hpcG1lbnRJRDtcclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoZXhpc3RpbmdSZWNvcmRJbmRleCA+IC0xKSB7IFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBsb2dnZXIuZGVidWcoJ0ZvdW5kIGEgbmV3IFZTIHRoYXQgbWF0Y2hlZCBhbiBleGlzdGluZyBvbmUnKTsgXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGFwLlZlbmRvclNoaXBwZWRzIVtleGlzdGluZ1JlY29yZEluZGV4XSA9IHZjO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgICAgIC8vIERldGVyaW1pbmUgYWxsIHJlY29yZHMgdGhhdCBhcmUgbmV3IGFuZCBkbyBub3QgbWF0Y2ggYW55IGV4aXN0aW5nIHJlY29yZHNcclxuICAgICAgICAgICAgICAgIGxldCB1bmlxdWVWU3MgOiBWZW5kb3JTaGlwcGVkW10gPSBuZXdWZW5kb3JTaGlwcGVkTGlzdC5yZWR1Y2UoKHBhYzpWZW5kb3JTaGlwcGVkW10sdmMsaWMsbGMpPT57XHJcbiAgICAgICAgICAgICAgICAgICAgbGV0IGV4aXN0aW5nUmVjb3JkSW5kZXggPSBhcC5WZW5kb3JTaGlwcGVkcyEuZmluZEluZGV4KChpbm5lclZDLGlubmVySUMsaW5uZXJMQyk9PntcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHZjLlJEQz09aW5uZXJWQy5SREMgJiYgdmMuU0tVID09IGlubmVyVkMuU0tVICYmIHZjLlVDQzEyOCA9PSBpbm5lclZDLlVDQzEyOCAmJiB2Yy5QT051bWJlcj09aW5uZXJWQy5QT051bWJlciAmJiB2Yy5BU05OdW1iZXI9PWlubmVyVkMuQVNOTnVtYmVyICYmIHZjLkFTTlNoaXBtZW50SUQ9PWlubmVyVkMuQVNOU2hpcG1lbnRJRDtcclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoZXhpc3RpbmdSZWNvcmRJbmRleCA9PSAtMSkgeyBcclxuICAgICAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLmRlYnVnKCdGb3VuZCBhIG5ldyBWUyB0aGF0IGRvZXMgbm90IG1hdGNoIHRoZSBleGlzdGluZyBvbmVzJyk7IFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBwYWMucHVzaCh2Yyk7IFxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gcGFjO1xyXG4gICAgICAgICAgICAgICAgfSwgW10pO1xyXG4gICAgICAgICAgICAgICAgbG9nZ2VyLmRlYnVnKGBFbmRlZCB1cCB3aXRoICR7dW5pcXVlVlNzLmxlbmd0aH0gdG90YWxseSBuZXcgVmVuZG9yU2hpcHBlZHNgKTtcclxuICBcclxuICAgICAgICAgICAgICAgIC8vIElmIHdlIGZvdW5kIHNvbWUgbmV3IHJlY29yZHMgdG8gYWRkLCBBcHBlbmQgbmV3IHJlY29yZHMgdG8gdGhlIGV4aXN0aW5nIG9uZXNcclxuICAgICAgICAgICAgICAgIGlmICh1bmlxdWVWU3MubGVuZ3RoID4gMCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGxvZ2dlci5kZWJ1ZygnQWRkaW5nIHRoZSBmaW5hbCBsaXN0IG9mIHVuaXF1ZSBWU3MgdG8gdGhlIGV4aXN0aW5nIGxpc3Qgb2YgVlNzJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgYXAuVmVuZG9yU2hpcHBlZHMucHVzaCguLi51bmlxdWVWU3MpO1xyXG4gICAgICAgICAgICAgICAgfSAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBsb2dnZXIuZGVidWcoJ0FkZGluZyBhbGwgbmV3IFZTcyBzaW5jZSB0aGVyZSBhcmUgbm8gZXhpc3RpbmcgVlNzLicpO1xyXG4gICAgICAgICAgICAgICAgYXAuc2V0U3RhZ2VEZXRhaWxzKFN0YWdlVHlwZS5WZW5kb3JTaGlwcGVkLCBuZXdWZW5kb3JTaGlwcGVkTGlzdCk7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIC8vIFJ1biB0aGlzIHRocm91Z2ggdGhlIHByb2Nlc3NpbmcgZW5naW5lIChGU00pXHJcbiAgICAgICAgICAgIGxvZ2dlci5kZWJ1ZygnU3RhcnRpbmcgdGhlIHByb2Nlc3NpbmcgZW5naW5lJyk7XHJcbiAgICAgICAgICAgIGxldCB1cGRhdGVkQVAgOiBBc3NldFByb2N1cmVtZW50ID0gUHJvY2Vzc2luZ0VuZ2luZS5zdGFydFByb2Nlc3NpbmcoYXAsIHsgdW9tTGlzdCwgYWRyUnVsZUxpc3QgfSk7XHJcbiAgICAgICAgICAgIGxvZ2dlci5kZWJ1ZygnRmluaXNoZWQgdGhlIHByb2Nlc3NpbmcgZW5naW5lJyk7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAvLyBTYXZlIHRoZSBBc3NldFByb2N1cmVtZW50IHJlY29yZFxyXG4gICAgICAgICAgICBpZiAoYXBJc05ldykge1xyXG4gICAgICAgICAgICAgICAgbG9nZ2VyLmRlYnVnKCdBdHRlbXB0aW5nIHRvIGNyZWF0ZSBhIG5ldyBBUCcpO1xyXG4gICAgICAgICAgICAgICAgYXdhaXQgYXBSZXBvLmNyZWF0ZSh1cGRhdGVkQVApO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgbG9nZ2VyLmRlYnVnKCdBdHRlbXB0aW5nIHRvIHVwZGF0ZSBhbiBleGlzdGluZyBBUCcpO1xyXG4gICAgICAgICAgICAgICAgYXdhaXQgYXBSZXBvLnVwZGF0ZSh1cGRhdGVkQVApO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBsb2dnZXIuZGVidWcoYHNhdmVWZW5kb3JTaGlwcGVkIHNhdmVkICR7bmV3VmVuZG9yU2hpcHBlZExpc3QubGVuZ3RofSBWZW5kb3JTaGlwcGVkIGl0ZW1zIGZvciBQT051bWJlciAke3BvTnVtYmVyfWApO1xyXG4gICAgICAgICAgICByZXR1cm4gdXBkYXRlZEFQO1xyXG4gICAgICAgIH0gY2F0Y2ggKGUpIHtcclxuICAgICAgICAgICAgbG9nZ2VyLmVycm9yKGBzYXZlVmVuZG9yU2hpcHBlZCBmYWlsZWQgZm9yIFBPTnVtYmVyICR7cG9OdW1iZXJ9YCk7XHJcbiAgICAgICAgICAgIGxvZ2dlci5lcnJvcihlKTtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbn0iXX0=